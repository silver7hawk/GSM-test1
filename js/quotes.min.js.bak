Netdania.ChartComponent={};Netdania.Utilities={};Netdania.Utilities.dateFormat={};(function(b){b.fn.overlayMask=function(e){var a=this.find(".nd-overlay-mask");if(!a.length){this.css({position:"relative"});a=b('<div class="nd-overlay-mask" style="text-align:center; padding-top:0px;font-family:Arial"><br/>Loading...</div>');a.css({position:"absolute",width:"100%",height:"100%",top:"0px",left:"0px",zIndex:100}).appendTo(this)}b(".nd-overlay-mask").css("background","#ccc url(css/images/loading.gif) no-repeat center center");b(".nd-overlay-mask").css({opacity:0.7});if(!e||e==="show"){a.show()}else{if(e==="hide"){a.hide()}}return this}})(jQuery);Netdania.Utilities.dateFormat=function(){var g=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,f=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[\-+]\d{4})?)\b/g,h=/[^\-+\dA-Z]/g,j=function(a,b){a=String(a);b=b||2;while(a.length<b){a="0"+a}return a};return function(m,B,F){var s=Netdania.Utilities.dateFormat;if(arguments.length==1&&(typeof m=="string"||m instanceof String)&&!/\d/.test(m)){B=m;m=undefined}m=m?new Date(m):new Date();if(isNaN(m)){throw new SyntaxError("invalid date")}B=String(s.masks[B]||B||s.masks["default"]);if(B.slice(0,4)=="UTC:"){B=B.slice(4);F=true}var D=F?"getUTC":"get",b=m[D+"Date"](),A=m[D+"Day"](),e=m[D+"Month"](),G=m[D+"FullYear"](),E=m[D+"Hours"](),c=m[D+"Minutes"](),C=m[D+"Seconds"](),a=m[D+"Milliseconds"](),y=F?0:m.getTimezoneOffset(),o={d:b,dd:j(b),ddd:s.i18n.dayNames[A],dddd:s.i18n.dayNames[A+7],m:e+1,mm:j(e+1),mmm:s.i18n.monthNames[e],mmmm:s.i18n.monthNames[e+12],yy:String(G).slice(2),yyyy:G,h:E%12||12,hh:j(E%12||12),H:E,HH:j(E),M:c,MM:j(c),s:C,ss:j(C),l:j(a,3),L:j(a>99?Math.round(a/10):a),t:E<12?"a":"p",tt:E<12?"am":"pm",T:E<12?"A":"P",TT:E<12?"AM":"PM",Z:F?"UTC":(String(m).match(f)||[""]).pop().replace(h,""),o:(y>0?"-":"+")+j(Math.floor(Math.abs(y)/60)*100+Math.abs(y)%60,4),S:["th","st","nd","rd"][b%10>3?0:(b%100-b%10!=10)*b%10]};return B.replace(g,function(k){return k in o?o[k]:k.slice(1,k.length-1)})}}();Netdania.Utilities.dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};Netdania.Utilities.dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Netdania.JsApi.arrRequests=[];Netdania.JsApi.globalCurrentReqId=0;Netdania.Utilities.globalCurrentCmp=0;Netdania.Utilities.findIndex=function(h,j){var f="";for(var g=0;g<h.length;g++){if(h[g]==j){return g}}return f};Netdania.Utilities.removeArrayItemByValue=function(h,f,g){var j=[];j=jQuery.grep(h,function(b){var a=g||"name";return b[a]!=f});return j};jQuery.fn.print=function(){if(this.size()>1){this.eq(0).print();return}else{if(!this.size()){return}}var l=("printer-"+(new Date()).getTime());var k=$("<iframe name='"+l+"'>");k.css("width","1px").css("height","1px").css("position","absolute").css("left","-9999px").appendTo($("body:first"));var h=window.frames[l];var m=this.jqplotToImageElemStr();var j=h.document;var n=$("<div>").append($("style").clone());j.open();j.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">');j.write("<html>");j.write("<body>");j.write("<head>");j.write("<title>");j.write(document.title);j.write("</title>");j.write(n.html());j.write("</head>");j.write(m);j.write("</body>");j.write("</html>");j.close();h.focus();h.print();setTimeout(function(){k.remove()},(60*1000))};$(function(){$(".ui-state-default:not(.ui-state-disabled, .ui-slider-range, .ui-progressbar-value), a.ui-datepicker-next, a.ui-datepicker-prev, .ui-dialog-titlebar-close").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})});Netdania.Utilities.createProperty=function(k){var h;var l={get:function(){return h},set:function(a){h=a;return h}};k=k||l;var g=k.get||function(){throw new Error("No get method defined for this property.")},j=k.set||function(){throw new Error("No set method defined for this property.")};return function(a){if(a!==undefined){return j(a)}return g()}};Netdania.Utilities.isBelowIEX=function(c){var e=c||9;if($.browser.msie&&parseInt($.browser.version,10)<e){return true}return false};Netdania.Utilities.AttachKeyboardEvent=function(f,g,h){var j=function(a){if(!a){var a=window.event}var b=a.keyCode;switch(b){case f:g(h);break}Netdania.Utilities.RemoveKeyboardEvent(j)};if(document.addEventListener){document.addEventListener("keyup",j)}else{document.attachEvent("onkeyup",j)}return j};Netdania.Utilities.RemoveKeyboardEvent=function(b){if(document.removeEventListener){document.removeEventListener("keyup",b,false)}else{document.detachEvent("onkeyup",b)}};Netdania.Utilities.setCursorByID=function(c,e){$(c)[0].style.cursor=e};var connection;Netdania.ChartComponent.ChartState=function(f){this.currentInstrument=f.currentInstrument;var e;var g;this.isVGridVisible=true;this.isHGridVisible=true;this.isZoomThemeActive=true;this.isStudyThemeActive=true;this.isVolumeThemeActive=true;this.isTrendlineMode=false;this.isZoomed=f.isZoomed||false;this.noOfVisibleStudies=f.noOfStudies;if(Netdania.Utilities.isBelowIEX()){this.isZoomBarVisible=false}else{this.isZoomBarVisible=!(f.noOfStudies>1?false:true)||f.showZoomBottomBar}this.isVolumeVisible=!(f.noOfStudies>1?false:true)||f.showVolume;this.zoomState=null;this.computeMainChartHeight=function(){var a="100";var b=(this.isZoomBarVisible?1:0)+(this.isVolumeVisible?1:0);if(this.noOfVisibleStudies+b>2){a=35}else{if(this.noOfVisibleStudies==2){a=50}else{a=100-25*b-25*this.noOfVisibleStudies}}return a};this.getVolumeChartHeight=function(){var a=(this.isZoomBarVisible?1:0)+(this.isVolumeVisible?1:0);if(this.noOfVisibleStudies===0){return 25}else{if(this.noOfVisibleStudies+a<3){return 25}else{return 65/(this.noOfVisibleStudies+a)}}};this.getZoomChartHeight=function(){var a=(this.isZoomBarVisible?1:0)+(this.isVolumeVisible?1:0);if(this.noOfVisibleStudies===0){return 25}else{if(this.noOfVisibleStudies+a<3){return 25}else{return 65/(this.noOfVisibleStudies+a)}}};this.getStudyChartHeight=function(){var a=(this.isZoomBarVisible?1:0)+(this.isVolumeVisible?1:0);if(this.noOfVisibleStudies+a>2){return 65/(this.noOfVisibleStudies+a)}else{return 25}};this.setZoomBarVisibility=function(a){this.isZoomBarVisible=a||false};this.setVolumeVisibility=function(a){this.isVolumeVisible=a||false};this.setNoOfVisibleStudies=function(a){this.noOfVisibleStudies=a};this.setVGridVisibility=function(a){this.isVGridVisible=!this.isVGridVisible};this.setHGridVisibility=function(a){this.isHGridVisible=!this.isHGridVisible};this.setZoomThemeActive=function(a){this.isZoomThemeActive=a};this.setVolumeThemeActive=function(a){this.isVolumeThemeActive=a};this.setStudyThemeActive=function(a){this.isStudyThemeActive=a};this.getLoadingVisibility=function(){var a=(this.isZoomBarVisible?1:0)+(this.isVolumeVisible?1:0)+this.noOfVisibleStudies;return(a>1)};this.toString=function(){console.log("volume: "+this.isVolumeVisible);console.log("zoom: "+this.isZoomBarVisible);console.log("studies: "+this.noOfVisibleStudies);console.log("***************")};this.setTrendlineMode=function(a){this.isTrendlineMode=a};this.getTrendlineMode=function(){return this.isTrendlineMode}};Netdania.StudyTypes={RSI:{studyName:"RSI",studyFullName:"Relative Strength Index",neutralValue:50,dependent:false,seriesCount:1,color:"#FF0000",parameters:{period:14},decimals:3,seriesColors:["#FF0000"]},MACD:{studyName:"MACD",studyFullName:"Average, Convergence-Divergence",neutralValue:50,dependent:false,seriesCount:3,color:"#EEFF00",period:10,parameters:{firstEMA:12,secondEMA:26,signalEMA:9},decimals:5,seriesColors:["#4AA5A5","#06CA47","#FF0000"]},ROC:{studyName:"ROC",studyFullName:"Rate of Change",neutralValue:50,dependent:false,seriesCount:1,color:"#4AA5A5",parameters:{period:10},decimals:4,seriesColors:["#4AA5A5"]},ATR:{studyName:"ATR",studyFullName:"Average True Range",neutralValue:50,dependent:false,seriesCount:1,color:"#06CA47",parameters:{period:15},smoothingPeriod:9,decimals:5,seriesColors:["#06CA47"]},BOLL:{studyName:"BOLL",studyFullName:"Bollinger Bands",neutralValue:50,dependent:false,seriesCount:2,color:"#06CA47",parameters:{period:20,standardDeviation:2},decimals:5,isOverlay:true,seriesColors:["#4AA5A5","#FF0000"],fillBetween:true},PKF:{studyName:"PKF",studyFullName:"Stochastic Fast",neutralValue:50,dependent:false,seriesCount:2,color:"#06CA47",parameters:{period:14,averagingPeriodFast:3},decimals:4,seriesColors:["#4AA5A5","#FF0000"]},PKS:{studyName:"PKS",studyFullName:"Stochastic Slow",neutralValue:50,dependent:false,seriesCount:2,color:"#06CA47",parameters:{period:5,averagingPeriodSlow:5,averagingPeriodFast:5},decimals:4,seriesColors:["#4AA5A5","#FF0000"]},MOM:{studyName:"MOM",studyFullName:"Momentum",neutralValue:50,dependent:false,seriesCount:1,color:"#4AA5A5",parameters:{period:10},decimals:5,seriesColors:["#4AA5A5"]},MAE:{studyName:"MAE",studyFullName:"Exponetial Moving Average",neutralValue:50,dependent:false,seriesCount:1,color:"#4AA5A5",parameters:{period:10},smoothFactor:0.2,decimals:5,isOverlay:true,seriesColors:["#4AA5A5"]},SMA:{studyName:"SMA",studyFullName:"Moving Average",neutralValue:50,dependent:false,seriesCount:1,color:"#06CA47",parameters:{period:10},decimals:5,isOverlay:true,seriesColors:["#06CA47"]},SAR:{studyName:"SAR",studyFullName:"Parabolic Sar",neutralValue:50,dependent:false,seriesCount:1,color:"#4AA5A5",period:10,parameters:{incrementalStep:0.02,maximumStep:0.2},decimals:5,isOverlay:true,seriesColors:["#4AA5A5"]},getStudyByName:function(b){switch(b){case"Relative Strength Index":return Netdania.StudyTypes.RSI;break}}};Netdania.ChartRenderer=function(bH){this.componentId=bH.globalId;var aZ="nd-chartDiv"+this.componentId;var aR="pricePointer"+this.componentId;var br="resizable"+this.componentId;var bW="volumePointer"+this.componentId;var bU="volumeChart"+this.componentId;var bM="nd-zoomChart"+this.componentId;var bB="nd-copy"+this.componentId;var aK="nd-volumeLabel"+this.componentId;var bn="nd-infoWindow"+this.componentId;var a3={showVolume:bH.showVolume||false,showZoomBottomBar:bH.showZoomBottomBar||false,noOfStudies:0};var aN=new Netdania.ChartComponent.ChartState(a3);this.getChartState=function(){return aN};var bQ=bH;bQ.options={};bQ.currentInstrument={};bQ.currentInstrument.decimals=5;var aY=bH.numberOfPoints;var bL=bH.numberOfPoints;bQ.zoomNumberOfPoints=(bH.defaultZoomNumberOfPoints!==undefined)?bH.defaultZoomNumberOfPoints:aY;this.timeScale=bH.timescale;var a0=this.timeScale;this.overlay=false;this.relativeTo=false;this.chartPlot=undefined;this.volumePlot=undefined;this.zoomPlot=undefined;var aV=false;var bY=false;var aW=-1;var bb=true;var aP=false;this.setCanUpdatePlot=function(a){bb=a};this.setRedrawTrendlines=function(a){aP=a};var aH=false;var bP=0;this.id=-1;this.ids=[];var bS=this.id;var bG=[];this.chartType=bH.chartType;var a4=bH.showVolume||false;var by=[];var bs=[];this.studiesPlot=[];var bC=[];var bq=null;var bi=bH.maxVisibleStudies||4;this.infoWindowTheme={color:"#000",colorOverlay:"#8B0000",colorRelativeTo:"#FF007F",colorStudy:"#FF0000",colorStudyOverlay:"#4AA5A5",colorCopyright:"#999",colorTooltip:"#EEE"};this.getMaxNumberOfHistoricalPoints=function(){return aY};this.getConfig=function(){return bQ};this.getStudies=function(){return bs};this.getSelf=function(){return this};var aM=bQ.timescaleFormat||["HH:MM:ss","HH:MM","dd.mm-HH:MM","dd.mm.yyyy"];var bj={CANDLESTICK:"candleStick",HEIKINASHI:"heikinAshi",LINE:"line",LINEDOT:"lineDot",FOREST:"forest",DOT:"dot",BARHLC:"barHLC",BAROHLC:"barOHLC",AREA:"area",VOLUME:"volume",ZOOM:"zoom"};this.ChartTypesEnum=bj;var a5={MainInstrument:0,Overlay:1,RelativeTo:2,Volume:3,Zoom:4,Study:5,StudyOverlay:6};var bE={Smoothness:{backgroundColor:"#FFFFFF|#ddd",lineColor:"#666",chartColor:"#000000",candleStickColors:undefined,volumeColor:"#FF0000",zoomColor:"#CCC",gridLineColor:"#aaa",axisColor:"#000",ticksfontFamily:"Copperplate",fillBetween:"rgba(170, 170, 170, 0.3)",trendlineColor:"#00F"},UIdarkness:{backgroundColor:"#454545|#111",lineColor:"#FFFFFF",chartColor:"#FF6600",candleStickColors:["#4AA5A5","#FF6600",undefined,undefined,"#FF6600"],volumeColor:"#B70000",zoomColor:"#CCC",gridLineColor:"#666",axisColor:"#ccc",fillBetween:"rgba(51, 51, 51, 0.3)",trendlineColor:"#4aa5a5"},UIlightness:{backgroundColor:"#FDF9E1|#FFFFFF",lineColor:"#666",chartColor:"#E78F08",candleStickColors:undefined,volumeColor:"#E78F08",zoomColor:"#E78F08",gridLineColor:"#bbb",axisColor:"#000",fillBetween:"rgba(227, 215, 142, 0.3)",trendlineColor:"#E78F08"},Start:{backgroundColor:"#FCFDFD|#cce0ed",lineColor:"#666",chartColor:"#000080",candleStickColors:undefined,volumeColor:"#000080",zoomColor:"#468EC2",gridLineColor:"#43a2ca",axisColor:"#000",fillBetween:"rgba(45, 99, 137, 0.3)",trendlineColor:"#0000ff"}};var ba={Smoothness:{color:"#000000",colorOverlay:"#8B0000",colorRelativeTo:"#FF007F",colorStudy:"#FF0000",colorCopyright:"#555",colorTooltip:"#999"},UIdarkness:{color:"#FF6600",colorOverlay:"#8B0000",colorRelativeTo:"#FF007F",colorStudy:"#FF0000",colorStudyOverlay:"#4AA5A5",colorCopyright:"#555",colorTooltip:"#999"},UIlightness:{color:"#7F4A05",colorOverlay:"#8B0000",colorRelativeTo:"#FF007F",colorStudy:"#FF0000",colorStudyOverlay:"#4AA5A5",colorCopyright:"#555",colorTooltip:"#999"},Start:{color:"#40405E",colorOverlay:"#8B0000",colorRelativeTo:"#FF007F",colorStudy:"#FF0000",colorStudyOverlay:"#4AA5A5",colorCopyright:"#555",colorTooltip:"#999"}};var bI=[];this.initChart=function(){this.setLoadingVisibility(true,true);var b=(bQ.padding!==undefined)?bQ.padding:10;if(Netdania.Utilities.isBelowIEX(7)){$('<div id="'+aZ+'" class="nd-chartDiv " style="height:'+aN.computeMainChartHeight()+"%; width:"+(bH.width-b)+'px;  text-align: center; vertical-align: middle; font-family: Verdana; font-size: 12px"><br/><br/><br/>Please use a modern browser like  IE9, Chrome, Firefox</div>').appendTo("#"+bH.plotId+bH.globalId);return}var e="https://www.goldenstatemint.com/proxy.php?url=";var f={pollingInterval:8000,host:e,behavior:Netdania.JsApi.ConnectionType.LONGPOLLING,type:1};connection=new Netdania.JsApi.JSONConnection(f);connection.addListener(Netdania.JsApi.Events.ONINFO,function(j){});connection.Connect();connection.Observer.subscribe(this);var c=(bQ.vaxis=="left")?b:0;$('<div id="'+aZ+'" class="nd-chartDiv " style="height:'+aN.computeMainChartHeight()+"%; width:"+(bH.width-b)+"px; margin-left:"+c+'px;"></div>').appendTo("#"+bH.plotId+bH.globalId);var g=[];g.push(Netdania.JsApi.Request.getReqObjChart(bH.symbol,bH.timescale,bL,bH.provider,true));this.id=Netdania.JsApi.globalCurrentReqId;this.ids.push(this.id);connection.appendRequests(g);var h=new Instrument({id:Netdania.JsApi.globalCurrentReqId,symbol:bH.symbol,name:bH.name,provider:bH.provider,type:a5.MainInstrument,chartType:bH.chartType,decimals:2});by.push(h);aW=this.id;if(aN.isZoomBarVisible){bq=new Instrument({id:aW,symbol:bH.symbol,name:bH.name,provider:bH.provider,type:a5.Zoom,chartType:bj.ZOOM});by.push(bq)}Netdania.Utilities.setCursorByID("#"+aZ,"crosshair");var a=this;$("body").bind("Custom.BeginWork",function(){a.setLoadingVisibility(true,true)});$("body").bind("Custom.EndWork",function(){a.setLoadingVisibility(false,true)})};var bo=false;this.saveState=function(){aN.isVolumeVisible=bH.showVolume?(aV&&this.volumePlot===null?false:true):!(this.volumePlot===null||this.volumePlot===undefined);aN.isZoomBarVisible=bH.showZoomBottomBar?(bY&&this.zoomPlot===null?false:true):!(this.zoomPlot===null||this.zoomPlot===undefined);aN.noOfVisibleStudies=bs.length};this.setLoadingVisibility=function(a,b){if($.browser.msie&&parseInt($.browser.version,10)===6){return}if(a){$("#nd-chartPlot"+this.componentId).overlayMask()}else{$("#nd-chartPlot"+this.componentId).overlayMask("hide")}};this.loadState=function(){if(!bo){bo=true;bo=false}};this.getChartState=function(){return aN};this.getMainInstrument=function(){var a;$(by).each(function(c,b){if(b.type==a5.MainInstrument){a=b}return});return a};Instrument=function(c){this.id=0;this.index=0;this.name="";this.symbol="";this.provider="";this.decimals=5;this.chartType="line";this.type=a5.MainInstrument;this.dateTimeArr=[];var e=[];this.seed=0;var a=0;this.ohlc=[];this.data;this.plotOptions;this.volume=null;Instrument.prototype.init=function(){if(c.id!==undefined){this.id=c.id}if(c.name!==undefined){this.name=c.name}if(c.symbol!==undefined){this.symbol=c.symbol}if(c.provider!==undefined){this.provider=c.provider}if(c.decimals!==undefined){this.decimals=c.decimals}if(c.chartType!==undefined){this.chartType=c.chartType}if(c.type!==undefined){this.type=c.type}if(c.typeS!==undefined){this.type=c.typeS}if(c.data!==undefined){this.data=c.data}if(c.chartType!==undefined){this.chartType=c.chartType}if(c.dateTimeArr!==undefined){this.dateTimeArr=c.dateTimeArr}this.type=c.type||a5.MainInstrument};this.setSeriesFormatForChartType=function(f){switch(f){case bj.CANDLESTICK:bQ.options.seriesFormat=[{renderer:$.jqplot.OHLCRenderer,rendererOptions:{candleStick:true,upBodyColor:"#0000ff",downBodyColor:"#ff0000",fillUpBody:"#0000ff",fillDownBody:"#ff0000",lineWidth:1,wickColor:"#000",shadow:false}}];break;case bj.HEIKINASHI:bQ.options.seriesFormat=[{renderer:$.jqplot.HeikinAshiRenderer,rendererOptions:{candleStick:true,upBodyColor:"#0000ff",downBodyColor:"#ff0000",fillUpBody:"#0000ff",fillDownBody:"#ff0000",lineWidth:1,wickColor:"#000"}}];break;case bj.BAROHLC:bQ.options.seriesFormat=[{renderer:$.jqplot.OHLCRenderer,rendererOptions:{candleStick:false,upBodyColor:"#ff0000",downBodyColor:"#0000ff",lineWidth:1,width:0}}];break;case bj.LINE:bQ.options.seriesFormat=[{showMarker:false,color:c.paramColor||"#FF6600",lineWidth:1}];break;case bj.AREA:bQ.options.seriesFormat=[{fill:true,showMarker:false,color:c.paramColor||"#FF6600",lineWidth:1,fillColor:"#c4cad3|#EEF0F3",fillAlpha:0.7}];break;case bj.DOT:bQ.options.seriesFormat=[{color:"#666",lineWidth:0.0001,markerOptions:{size:5}}];break;case bj.LINEDOT:bQ.options.seriesFormat=[{color:"#666",lineWidth:0.5,markerOptions:{size:5}}];break;case bj.FOREST:bQ.options.seriesFormat=[{color:"#000000",renderer:$.jqplot.ForestRenderer,rendererOptions:{fillToZero:true,lineWidth:0.7,shadow:false}}];break;case bj.BARHLC:bQ.options.seriesFormat=[{renderer:$.jqplot.OHLCRenderer,rendererOptions:{upBodyColor:"#000",downBodyColor:"#000",lineWidth:1}}];break;case bj.VOLUME:bQ.options.seriesFormat=[{renderer:$.jqplot.CustomBarRenderer,rendererOptions:{color:"#FF0000",barPadding:10,barWidth:2,varyBarColor:false,shadow:false,fillStyle:"#FF0000",showMarker:false},color:"#FF0000"}];break;case bj.ZOOM:bQ.options.seriesFormat=[{showMarker:false,color:"#CCC",lineWidth:2}];break}return bQ.options.seriesFormat};this.TicksFormatter=function(g,f){return Netdania.Utilities.dateFormat(e[parseInt(f)],g)};this.updateDtArray=function(f){e.shift();e.push(f)};this.setdtArr=function(){e=this.dateTimeArr};this.setTimeScale=function(f){a0=f};this.getTimescaleFormat=function(j,h){for(var g=0;g<h.length;g++){var f=h[g].split("|");if(f[3]&&f[1]==j&&f[2]==bL){return f[3]}}return null};this.setOptions=function(j){var l;if(j!==undefined){l=this.setSeriesFormatForChartType(j)}var n=null;if(bQ.toolbarTimescales){n=this.getTimescaleFormat(a0,bQ.toolbarTimescales)}if(n==null){switch(a0){case 0:n=aM[0];break;case 1:case 5:case 10:case 15:n=aM[1];break;case 30:case 60:case 120:case 240:n=aM[2];break;default:n=aM[3]}}var m={captureRightClick:true,seriesDefaults:{yaxis:(bQ.vaxis=="left")?"yaxis":"y2axis",breakOnNull:false,rendererOptions:{padding:1},fill:(j==bj.ZOOM)?true:false,fillAndStroke:true,fillColor:"#eaeaea",fillAlpha:1,shadow:false,rendererOptions:{highlightMouseOver:false}},axesDefaults:{tickOptions:{angle:0,showGridline:j==bj.ZOOM?false:true,textColor:"#999"},showTickMarks:(j==bj.VOLUME||j==bj.ZOOM)?false:true,showTicks:(j==bj.VOLUME||j==bj.ZOOM)?false:true},axes:{xaxis:{pad:1,autoscale:true,tickOptions:{formatString:n,formatter:this.TicksFormatter,showLabelFirstTick:false,showLabelLastTick:false,showLabel:(j==bj.ZOOM||j==bj.VOLUME||this.type==a5.Study)?false:true,textColor:"#999",showGridline:(j==bj.ZOOM)?false:aN.isVGridVisible}},y2axis:{tickOptions:{formatString:(bQ.yAxisSymbol||"")+" %."+this.decimals+"f",showGridline:(bQ.vaxis=="left")?false:((j==bj.ZOOM)?false:aN.isHGridVisible)},fontSize:"10px",forceMin0:(j==bj.VOLUME)?true:false},yaxis:{tickOptions:{showGridline:(bQ.vaxis=="right")?false:((j==bj.ZOOM)?false:aN.isHGridVisible),formatString:"%."+this.decimals+"f"},fontSize:"10px",forceMin0:(j==bj.VOLUME)?true:false},y3axis:{tickOptions:{showGridline:false,formatString:"%.0f"}}},grid:{drawGridLines:false,background:j==bj.ZOOM?"#f5f5f5|#f5f5e0":"#fff|#ffffd0",drawBorder:false,shadow:false,gridLineColor:"#373737",gridLineWidth:0.5},series:l,cursor:{show:true,style:"",zoom:true,minZoom:10,tooltipLocation:(j!==bj.VOLUME&&bH.tooltipLocation!==undefined)?bH.tooltipLocation:"nw",followMouse:(bH.useMovingTooltip!==undefined&&j!==bj.VOLUME)?bH.useMovingTooltip:false,showTooltip:false,showCustomTooltip:(j==bj.ZOOM)?false:(bH.showTooltip!==undefined)?bH.showTooltip:false,tooltipFormatString:'<div class="nd-tooltip">                                         <table cellspacing="0" cellpadding="0"><tr><td colspan="2"><div class="nd-tooltip-x">%0%</div></td><tr>                                         <tr><td colspan="2"><div class="nd-tooltip-x">%00%</div></td><tr>                                         <tr><td><div class="nd-tooltip-yLabel">O:</div></td><td><div class="nd-tooltip-y">%2%</div></td><tr>                                         <tr><td><div class="nd-tooltip-yLabel">H:</div></td><td><div class="nd-tooltip-y">%3%</div></td><tr>                                         <tr><td><div class="nd-tooltip-yLabel">L:</div></td><td><div class="nd-tooltip-y">%4%</div></td><tr>                                         <tr><td><div class="nd-tooltip-yLabel">C:</div></td><td><div class="nd-tooltip-y">%1%</div></td><tr>                                         <tr><td><div class="nd-tooltip-yLabel">V:</div></td><td><div class="nd-tooltip-y">%5%</div></td><tr>                                         </table></div>',tooltipFormatStringFixed:(j==bj.VOLUME)?'<div class="nd-tooltip-volume">%0%, %5%</div>':(bH.tooltipLocation==="outside")?'<div class="nd-tooltip-static">OHLC: %1%, %2%, %3%, %4% </div>':'<div class="nd-tooltip-static">O: %1%, H: %2%, L: %3%, C: %4% </div>',constrainZoomTo:"x",showVerticalLine:(j==bj.ZOOM)?false:true,showHorizontalLine:(j==bj.ZOOM)?false:true,constrainOutsideZoom:false,lineOptions:{linePattern:"dashed",lineWidth:1,color:"#FF0000"}}};var f="";switch(j){case bj.ZOOM:f="zoom";break;case bj.VOLUME:f="volume";break;case bj.LINE:f="line";break;default:f="chart";break}var h=$.cookie("jquery-ui-theme"),g;switch(h){case"Smoothness":g=b(f,bE.Smoothness);break;case"UI darkness":g=b(f,bE.UIdarkness);break;case"UI lightness":g=b(f,bE.UIlightness);break;case"Start":g=b(f,bE.Start);break}switch(f){case"zoom":m.series[0].color=g.series[0].color;m.series[0].fillColor=g.series[0].fillColor;m.grid.gridLineColor=g.grid.gridLineColor;m.grid.backgroundColor=g.grid.backgroundColor;m.grid.borderColor=g.grid.borderColor;break;case"volume":m.series[0].rendererOptions=g.series[0].rendererOptions;m.grid.backgroundColor=g.grid.backgroundColor;m.cursor.lineOptions.color=g.cursor.linesColor;break;case"chart":m.series[0].color=g.series[0].color;try{m.series[0].rendererOptions.upBodyColor=g.series[0].rendererOptions.upBodyColor;m.series[0].rendererOptions.downBodyColor=g.series[0].rendererOptions.downBodyColor;m.series[0].rendererOptions.fillUpBody=g.series[0].rendererOptions.fillUpBody;m.series[0].rendererOptions.fillDownBody=g.series[0].rendererOptions.fillDownBody;m.series[0].rendererOptions.wickColor=g.series[0].rendererOptions.wickColor;m.series[0].rendererOptions.lineWidth=g.series[0].rendererOptions.lineWidth}catch(k){}m.grid.backgroundColor=g.grid.backgroundColor;m.grid.gridLineColor=g.grid.gridLineColor;m.grid.backgroundColor=g.grid.backgroundColor;m.grid.borderColor=g.grid.borderColor;m.cursor.lineOptions.color=g.cursor.linesColor;m.axes.xaxis.tickOptions.textColor=g.axes.xaxis.tickOptions.textColor;m.axesDefaults.tickOptions.textColor=g.axesDefaults.tickOptions.textColor;break;default:m.cursor.lineOptions.color=g.cursor.linesColor;m.grid.backgroundColor=g.grid.backgroundColor;m.axes.xaxis.tickOptions.textColor=g.axes.xaxis.tickOptions.textColor;m.axesDefaults.tickOptions.textColor=g.axesDefaults.tickOptions.textColor;try{m.series[0].color=c.paramColor||g.series[0].color}catch(k){}break}return m};var b=function(h,g){var f;switch(h){case"chart":f={series:[{color:g.chartColor,rendererOptions:{upBodyColor:(g.candleStickColors!==undefined&&g.candleStickColors[0]!==undefined)?g.candleStickColors[0]:"#0000ff",downBodyColor:(g.candleStickColors!==undefined&&g.candleStickColors[1]!==undefined)?g.candleStickColors[1]:"#ff0000",fillUpBody:(g.candleStickColors!==undefined&&g.candleStickColors[2]!==undefined)?g.candleStickColors[2]:"#0000ff",fillDownBody:(g.candleStickColors!==undefined&&g.candleStickColors[3]!==undefined)?g.candleStickColors[3]:"#ff0000",wickColor:(g.candleStickColors!==undefined&&g.candleStickColors[4]!==undefined)?g.candleStickColors[4]:"#000000",lineWidth:0.7}},{}],grid:{backgroundColor:g.backgroundColor,gridLineColor:g.gridLineColor||"#999",borderColor:g.gridLineColor||"#999"},cursor:{linesColor:g.lineColor},axesDefaults:{tickOptions:{textColor:g.axisColor||"#999"}},axes:{xaxis:{tickOptions:{textColor:g.axisColor||"#999"}}},axesStyles:{ticks:{textColor:g.axisColor||"#999"}}};break;case"volume":f={series:[{rendererOptions:{color:g.volumeColor,barPadding:10,barWidth:2,varyBarColor:false,shadow:false,fillStyle:g.volumeColor,showMarker:false}}],grid:{backgroundColor:g.backgroundColor},cursor:{linesColor:g.lineColor}};break;case"zoom":f={series:[{fillColor:g.zoomColor,color:g.zoomColor}],grid:{backgroundColor:g.backgroundColor,gridLineColor:g.gridLineColor||"#999",borderColor:g.gridLineColor||"#999"}};break;default:f={grid:{backgroundColor:g.backgroundColor},cursor:{linesColor:g.lineColor},axesDefaults:{tickOptions:{textColor:g.axisColor||"#999"}},axes:{xaxis:{tickOptions:{textColor:g.axisColor||"#999"}}},axesStyles:{ticks:{textColor:g.axisColor||"#999"}}}}return f};this.setDataForChartType=function(f,h){dataArray=[];switch(h){case bj.LINE:case bj.AREA:case bj.LINEDOT:case bj.FOREST:case bj.DOT:case bj.ZOOM:for(var j=0;j<f.length;j++){var g=[];g[0]=f[j][0];g[1]=f[j][4];dataArray.push(g)}break;case bj.BARHLC:for(var j=0;j<f.length;j++){var g=[];g[0]=f[j][0];g[1]=f[j][2];g[2]=f[j][3];g[3]=f[j][4];dataArray.push(g)}break;case bj.CANDLESTICK:case bj.BAROHLC:case bj.HEIKINASHI:for(var j=0;j<f.length;j++){var g=[];g[0]=f[j][0];g[1]=f[j][1];g[2]=f[j][2];g[3]=f[j][3];g[4]=f[j][4];dataArray.push(g)}break}return dataArray};this.setVolume=function(f,h){var g=[];var f=new Instrument({id:-100,symbol:this.symbol,provider:this.provider,type:a5.Volume,data:f,dateTimeArr:h,decimals:0});f.setdtArr(h);f.plotOptions=f.setOptions(bj.VOLUME);f.plotOptions.axes[f.plotOptions.seriesDefaults.yaxis].min=0;return f};this.setOHLC=function(r){this.seed=0;this.ohlc=[];this.dateTimeArr=[];this.volume=null;e=[];var q=new Date();var h=[];var l=[];var j=[];len=r[0].v.length;for(var m=0;m<len;m++){var g=[];var f=[];for(var n=0;n<r.length;n++){var k=r[n].f;switch(k){case 100:var q=new Date(r[n].v[m]*1000);var o=q.setMilliseconds(q.getMilliseconds());this.dateTimeArr.push(o);e.push(o);j.push(o);g[0]=f[0]=this.seed++;break;case 101:g[1]=r[n].v[m];break;case 102:g[2]=r[n].v[m];break;case 103:g[3]=r[n].v[m];break;case 104:g[4]=r[n].v[m];this.decimals=this.decimals||2;break;case 105:f[1]=r[n].v[m];g[5]=r[n].v[m];break}}h.push(g);l.push(f)}this.volume=this.setVolume(l,j);this.ohlc=h;this.data=this.setDataForChartType(this.ohlc,this.chartType);this.plotOptions=this.setOptions(this.chartType);a=this.seed;h=l=j=r=null};this.updatePlotOptions=function(){this.plotOptions.axes[this.plotOptions.seriesDefaults.yaxis].tickOptions.showGridline=aN.isHGridVisible;this.plotOptions.axes.xaxis.tickOptions.showGridline=aN.isVGridVisible};this.initializeInstrument=function(f){this.volume=f.volume;this.ohlc=f.ohlc||[];this.data=this.setDataForChartType(this.ohlc,this.chartType)||[];this.plotOptions=this.setOptions(this.chartType)};if(c!==undefined){this.init(c)}};function aS(b,a){if($("#nd-duplicateDialog").length){$("#nd-duplicateDialog").remove()}$("#"+aZ).append('<div id="nd-duplicateDialog" title="'+b+'"><p>'+a+"</p></div>");$("#nd-duplicateDialog").dialog({autoOpen:false,modal:true,dialogClass:"nd-dialog",resizable:false,zIndex:10000,buttons:{Ok:function(){$(this).dialog("close")}}});$("#nd-duplicateDialog").dialog("open")}this.filter=function(k,e,b){var n=[];var q=e.data;var c=[];var a=k.length;var h=60;var g=[];for(var l=0;l<a;l++){g.push(parseInt(e.dateTimeArr[q[l][0]]/h)*h)}var o=[];for(var l=0;l<a;l++){o.push(parseInt(e.dateTimeArr[k[l]]/h)*h)}var l=0;var m=0;var j=0;while(l<a){while(m<q.length&&o[l]!==g[m]){m++}if(m<q.length){if(l===0){j=q[m][1];b.scaleFactor=j;n.push([k[m],0])}else{var f=(q[m][1]/j-1)*100;n.push([k[m],f])}}else{}l++}return n};StudyInstrument=function(b){this.instrumentId=b.instrumentId;this.name=b.name;this.studyFullName=b.studyFullName;this.neutralValue=b.neutralValue;this.dependent=b.dependent;this.seriesCount=b.seriesCount;this.volumeNeeded=false;this.paramColor=b.paramColor;this.studyName="RSI";this.period=b.period;this.isOverlay=b.isOverlay||false;this.series=null;this.seriesColors=b.seriesColors;this.fillBetween=b.fillBetween||false;if(b.studyName!=undefined){this.studyName=b.studyName}if(this.isOverlay){this.series=[];for(var a=0;a<this.seriesCount;a++){this.series.push({data:[],plotOptions:null})}}this.parent.constructor.call(this,b)};StudyInstrument.prototype=new Instrument();StudyInstrument.prototype.constructor=StudyInstrument;StudyInstrument.prototype.parent=Instrument.prototype;var bV=function(c,a,e,h,j,q){if(c.length<h){return null}if(j==null||j.length<e){j=[]}var m;var o;var n=0;var f=0;var b=0;var r=0;var l=0;var k=0;for(m=a+1;m<=a+h;m++){if(c[m][1]>=c[m-1][1]){l=c[m][1]-c[m-1][1];n+=l;k=0}if(c[m][1]<=c[m-1][1]){k=c[m-1][1]-c[m][1];f+=k;l=0}}b=n/h;r=f/h;o=b/r;var g;if(f!=0){g=100-100/(1+o)}else{g=100}for(m=0;m<=a+h;m++){j[m]=g.toFixed(2)}for(m=a+h+1;m<e;m++){if(c[m][1]>=c[m-1][1]){l=c[m][1]-c[m-1][1];k=0}if(c[m][1]<=c[m-1][1]){k=c[m-1][1]-c[m][1];l=0}b=(b*(h-1)+l)/h;r=(r*(h-1)+k)/h;if(r!=0){o=b/r;j[m]=(100-100/(1+o)).toFixed(q)}else{j[m]=100}}return j};computeROC=function(f,j,g,b,e,a){if(e==null||e.length<g){e=[]}var h;for(h=j+b;h<g;h++){if(f[h-b][1]!=0){e[h]=parseFloat((100*(f[h][1]/f[h-b][1])));e[h]=e[h].toFixed(a)}else{e[h]=Netdania.StudyTypes.ROC.neutralValue}}var c=j+b;h=0;for(h=0;h<c&&h<g;h++){e[h]=e[c]}return e};var aI=function(c,b,e,g,j){if(j==null||j.length<e){j=[]}var f=[];var l;var k,a,h;for(l=b;l<e;l++){k=c[l][2];a=c[l][3];if(l>b){h=c[l-1][4]}else{h=c[l][4]}if(h<a){a=h}if(h>k){k=h}f[l]=k-a}return bX(f,b,e,g,j)};var bX=function(e,a,h,b,c){if(c==null||c.length<h){c=[]}var g=0;var j;for(j=0;j<b&&a+j<h;j++){g+=e[a+j]}var f=g/b;for(j=0;j<a+b&&j<h;j++){c[j]=f}for(;j<h;j++){g-=e[j-b];g+=e[j];c[j]=g/b}return c};computeMACD=function(b,q,e,l,m,n,f,g,h){if(f==null||f.length<e){f=[]}if(g==null||g.length<e){g=[]}if(h==null||h.length<e){h=[]}var j=[];for(var k=0;k<e;k++){j[k]=b[k][1]}var k;var o,a,c;o=2/(l+1);a=2/(m+1);c=2/(n+1);for(k=0;k<=q&&k<e;k++){f[k]=0;g[k]=0;h[k]=0}if(q>=e){return}g=computeMAE(j,q,e,a,parseInt(m),g);h=computeMAE(j,q,e,o,parseInt(l),h);for(k=0;k<q;k++){f[k]=0}for(k=q;k<e;k++){f[k]=-(g[k]-h[k])}g=computeMAE(f,q+parseInt(l)-1,e,c,parseInt(n),g);for(k=0;k<q+parseInt(m)-1;k++){h[k]=0}for(k=q+parseInt(m)-1;k<e;k++){h[k]=f[k]-g[k]}return[f,g,h]};computeMAE=function(c,b,e,j,g,h){if(h==null||h.length<e){h=[]}if(b>=e){return h}var f=0;var k;for(k=b;k<b+g&&k<e;k++){f+=c[k]}var a=b+g-1;if(a<e){h[a]=f/g}else{a=e-1}for(k=b+g;k<e;k++){h[k]=(1-j)*h[k-1]+j*c[k]}for(k=0;k<a&&k<e;k++){h[k]=h[a]}return h};computeBOLL=function(k,b,e,j,l,g,h){var m;var f;if(g==null||g.length<e){g=[]}if(h==null||h.length<e){h=[]}var c=[];for(var m=0;m<e;m++){c[m]=k[m][1]}g=bX(c,b,e,j,g);h=computeSTDDEV(c,g,b,e,j,h);for(m=0;m<e;m++){f=g[m];g[m]=f+l*h[m];h[m]=f-l*h[m]}var a=b+j-1;for(m=0;m<a&&m<e;m++){g[m]=g[a];h[m]=h[a]}return[g,h]};computeSTDDEV=function(c,k,b,e,f,g){if(g==null||g.length<e){g=[]}var j,l;var h=0;for(j=0;j<f&&b+j<e;j++){h+=(c[b+j]-k[b])*(c[b+j]-k[b])}var a=Math.sqrt(h/f);for(j=0;j<b+f&&j<e;j++){g[j]=a}for(;j<e;j++){for(h=0,l=0;l<f;l++){h+=(c[j-l]-k[j])*(c[j-l]-k[j])}g[j]=Math.sqrt(h/f)}return g};computePKF=function(c,a,e,m,b,g,j,n){var k=0;if(g==null||g.length<e){g=[]}if(j==null||j.length<e){j=[]}var o=[];var f=[];var h=[];for(var l=0;l<c.length;l++){o[l]=c[l][4];f[l]=c[l][2];h[l]=c[l][3]}return computeStochOsc(o,f,h,a,e,m,b,0,g,j,k,n)};computeStochOsc=function(v,g,h,t,o,l,q,s,c,e,n,b){if(c==null||c.length<o){c=[]}if(e==null||e.length<o){e=[]}var r=calculateMinLowAndMaxHigh(g,h,t,o,l,false);var j=r[0];var a=r[1];var k=t+l-1;for(var m=k;m<o;m++){var f=v[m]-j[m];var u=a[m]-j[m];c[m]=(u==0?50:parseFloat((f/u)*100))}if(k<o){for(var m=0;m<k&&m<o;m++){c[m]=c[k]}}if(n==0){e=bX(c,k,o,q,e,b)}else{if(n==1){e=computeMAE(c,k,o,s,q,e)}}return[c,e]};calculateMinLowAndMaxHigh=function(f,h,c,e,j,a){var g=null;var q=null;if(a){g=[];q=[]}var n=[];var b=[];for(var l=c+j-1;l<e;l++){b[l]=-10000000000;n[l]=10000000000;if(a){g[l]=0;q[l]=0}for(var m=0;m<j;m++){var o=f[l-m];var k=h[l-m];if(b[l]<o){b[l]=o;if(a){g[l]=m}}if(n[l]>k){n[l]=k;if(a){q[l]=m}}}}if(a){return[q,g]}return[n,b]};computePKS=function(l,u,m,h,q,v,w,y){if(w==null||w.length<m){w=[]}if(y==null||y.length<m){y=[]}var t=[];var z=[];var a=[];for(var c=0;c<l.length;c++){t[c]=l[c][4];z[c]=l[c][2];a[c]=l[c][3]}var r=0;var j=0;var o=0;var n=0;var c,f;var s=calculateMinLowAndMaxHigh(z,a,u,m,h,false);var b=s[0];var x=s[1];for(c=u+h-1;c<u+h+q-1&&c<m;c++){var k=t[c];r=(k-b[c]);j=(x[c]-b[c]);o+=(j==0?0.5:r/j)}var e=c-1;for(var f=u;f<=e;f++){w[f]=o*100/q}for(;c<m;c++){r=(t[c-q]-b[c-q]);j=(x[c-q]-b[c-q]);o-=(j==0?0.5:r/j);r=(t[c]-b[c]);j=(x[c]-b[c]);o+=(j==0?0.5:r/j);w[c]=o*100/q}c=u+h+q-2;for(n=0,f=0;f<v&&c+f<m;f++){n+=w[c+f]}var g=c+f-1;if(g<m){y[g]=n/v}for(f=c+f;f<m;f++){n-=w[f-v];n+=w[f];y[f]=n/v}return[w,y]};computeMomentum=function(f,a,g,b,e){if(e==null||e.length<g){e=[]}for(var h=a+b;h<g;h++){e[h]=f[h][1]-f[h-b][1]}var c=a+b;for(var h=0;h<c&&h<g;h++){e[h]=e[c]}return e};computeSAR=function(h,v,k,c,t,w){if(w==null||w.length<k){w=[]}var s=[];var z=[];var C=[];for(var e=0;e<h.length;e++){s[e]=h[e][4];z[e]=h[e][2];C[e]=h[e][3]}var e;var D=c;var g=c*0.000001;var b;var n=0;for(b=v+1;b<k;b++){if(z[b]>z[b-1]&&C[b]>C[b-1]){n=1;break}if(z[b]>=z[b-1]||C[b]>C[b-1]){continue}n=-1;break}if(b+1>k){return b}var q=z[0];var y=C[0];for(e=v+1;e<b+1;e++){if(z[e]>q){q=z[e]}if(C[e]<y){y=C[e]}}if(n<0){w[b]=q}else{w[b]=y}var j=n;var m=true;var l=(j==1)?y:q;var x=w[b];var o;var r=z[b];var A=C[b];var f=b+1;for(;f<k;){var u=z[f];var B=C[f];if(!m&&B<w[f]&&w[f]<u){j=-j;x=l;m=true}if(j==1){if(m){w[f]=x;l=u;D=c;if(f<k-1){w[f+1]=(w[f]+D*(l-w[f]))}m=false;continue}else{if(u>l){l=u;if(D+g<t){D+=c}}o=w[f]+D*(l-w[f]);if(o>=B||o>=A){if(B<=A){o=B}else{o=A}}if(f<k-1){w[f+1]=o}}}else{if(m){w[f]=x;l=B;D=c;if(f<k-1){w[f+1]=(w[f]+D*(l-w[f]))}m=false;continue}else{if(B<l){l=B;if(D+g<t){D+=c}}o=w[f]+D*(l-w[f]);if(o<=u||o<=r){if(u>=r){o=u}else{o=r}}if(f<k-1){w[f+1]=o}}}r=u;A=B;f++}var a=v+b;for(var e=0;e<a&&e<k;e++){w[e]=w[a]}return w};checkIfStudyIsAdded=function(b){var a=false;$(bs).each(function(e,c){if(c.type===a5.Study){if(c.name===b.studyName){a=true;return}}});$(by).each(function(e,c){if(c.type===a5.StudyOverlay){if(c.name===b.studyName){a=true;return}}});return a};this.createStudy=function(c,e){if(c.parameters.period>aY){aS("Error","Not enough data! Study cannot be computed!");return false}a6(this);bA(this);aQ(this);a2(this);bG=[];connection.removeRequests(this.ids);this.ids=[];var f=[];if(this.timeScale==0){bH.timeScale=this.timeScale=1}for(var a=0;a<by.length;a++){switch(by[a].type){case a5.Zoom:by.splice(a,1);break;case a5.MainInstrument:f.push(Netdania.JsApi.Request.getReqObjChart(by[a].symbol,this.timeScale,bL,by[a].provider,true));this.ids.push(Netdania.JsApi.globalCurrentReqId);by[a].id=Netdania.JsApi.globalCurrentReqId;this.id=Netdania.JsApi.globalCurrentReqId;break;case a5.Overlay:case a5.RelativeTo:f.push(Netdania.JsApi.Request.getReqObjChart(by[a].symbol,this.timeScale,bL,by[a].provider,true));this.ids.push(Netdania.JsApi.globalCurrentReqId);by[a].id=Netdania.JsApi.globalCurrentReqId;break;default:break}}if(c.isOverlay==true){var b=new StudyInstrument({id:this.id+"_s",symbol:bH.symbol,provider:bH.provider,type:a5.StudyOverlay,studyName:c.studyName,name:c.studyName,studyFullName:c.studyFullName,neutralValue:c.neutralValue,dependent:false,seriesCount:c.seriesCount,paramColor:c.color,decimals:c.decimals,seriesColors:c.seriesColors,isOverlay:c.isOverlay,instrumentId:this.id,fillBetween:c.fillBetween,period:c.period});bg(c,b,e);by.push(b)}else{if(bs.length==bi){var a=-1;$(by).each(function(h,g){if(g.id==bs[0].id&&g.type==a5.Study){a=h;return}});by.splice(a,1);bs.splice(0,1)}var b=new StudyInstrument({id:this.id,symbol:bH.symbol,provider:bH.provider,type:a5.Study,studyName:c.studyName,name:c.studyName,studyFullName:c.studyFullName,neutralValue:c.neutralValue,dependent:false,seriesCount:c.seriesCount,paramColor:c.color,decimals:c.decimals,seriesColors:c.seriesColors,period:c.period});bg(c,b,e);by.push(b);bs.push(b);aN.setNoOfVisibleStudies(bs.length)}if(aN.isZoomBarVisible){bq=new Instrument({id:aW,symbol:bH.symbol,name:name,provider:bH.provider,type:a5.Zoom,chartType:bj.ZOOM});by.push(bq)}connection.appendRequests(f)};function bg(c,b,e){for(var a in e){if(c.parameters[a]!==undefined){b[a]=e[a]}}}this.computeStudyOverlay=function(c,g,e){var f=[];switch(c.studyName){case Netdania.StudyTypes.BOLL.studyName:f=computeBOLL(e,0,e.length,c.period,c.standardDeviation,null,null);for(var a=0;a<c.seriesCount;a++){c.series[a].data=bJ(f[a],e);c.series[a].plotOptions={showMarker:false,color:c.seriesColors[a],lineWidth:1,label:"study"}}break;case Netdania.StudyTypes.MAE.studyName:var b=[];for(var a=0;a<e.length;a++){b.push(e[a][1])}f=computeMAE(b,0,b.length,Netdania.StudyTypes.MAE.smoothFactor,c.period,null);c.series[0].data=bJ(f,e);c.series[0].plotOptions={showMarker:false,color:c.seriesColors[0],lineWidth:0.5,label:"study"};break;case Netdania.StudyTypes.SMA.studyName:var b=[];for(var a=0;a<e.length;a++){b.push(e[a][1])}f=bX(b,0,b.length,c.period,null);c.series[0].data=bJ(f,e);c.series[0].plotOptions={showMarker:false,color:c.seriesColors[0],lineWidth:0.5,label:"study"};break;case Netdania.StudyTypes.SAR.studyName:f=computeSAR(g,0,g.length,c.incrementalStep,c.maximumStep,null);for(var a=0;a<c.seriesCount;a++){c.series[a].data=bJ(f,g);c.series[a].plotOptions={showMarker:Netdania.Utilities.isBelowIEX(9)?false:true,color:c.seriesColors[a],showLine:Netdania.Utilities.isBelowIEX(9)?true:false,label:"study",markerOptions:{size:2.5},lineWidth:0.5}}break;default:break}return c};function bJ(c,a){var b=[];$(c).each(function(h,f){if(h>0){var g=[];g[0]=a[h-1][0];g[1]=parseFloat(f);b.push(g);g=null}});var e=[];e[0]=a[c.length-1][0];e[1]=parseFloat(c[c.length-1]);b.push(e);return b}this.recomputeStudyOverlay=function(c,a,e,b){c=this.computeStudyOverlay(c,a,e);$(c.series).each(function(g,f){b.series[c.index+g].data=f.data})};this.computeStudies=function(b,a){var c=this;$(bs).each(function(l,g){var h=g;var e=b.dateTimeArr.length-1;h.dateTimeArr.shift();h.dateTimeArr.push(b.dateTimeArr[e]);h.updateDtArray(b.dateTimeArr[e]);var j=[];switch(h.name){case Netdania.StudyTypes.RSI.studyName:j=bV(a,0,a.length,h.period,null,h.decimals);break;case Netdania.StudyTypes.ROC.studyName:j=computeROC(a,0,a.length,h.period,null,h.decimals);break;case Netdania.StudyTypes.ATR.studyName:j=aI(b.ohlc,0,b.ohlc.length,h.period,null,h.decimals);break;case Netdania.StudyTypes.MACD.studyName:j=computeMACD(a,0,a.length,h.firstEMA,h.secondEMA,h.signalEMA,null,null,null);break;case Netdania.StudyTypes.PKF.studyName:j=computePKF(b.ohlc,0,b.ohlc.length,h.period,h.averagingPeriodFast,null,null);break;case Netdania.StudyTypes.PKS.studyName:j=computePKS(b.ohlc,0,b.ohlc.length,h.period,h.averagingPeriodSlow,h.averagingPeriodFast,null,null);break;case Netdania.StudyTypes.MOM.studyName:j=computeMomentum(a,0,a.length,h.period,null);break;case Netdania.StudyTypes.SAR.studyName:j=computeSAR(a,0,a.length,h.incrementalStep,h.maximumStep,null);break;default:break}var f=[];if(h.seriesCount==1){$(j).each(function(n,o){if(n>0){var m=[];m[0]=n-1;m[1]=parseFloat(o);f.push(m);m=null}});var k=[];k[0]=j.length-1;k[1]=parseFloat(j[j.length-1]);f.push(k);c.studiesPlot[l].series[0].data=f}else{$(j).each(function(n,o){$(o).each(function(q,s){if(q>0){var r=[];r[0]=q-1;r[1]=parseFloat(s);f.push(r);r=null}});var m=[];m[0]=o.length-1;m[1]=parseFloat(o[o.length-1]);f.push(m);c.studiesPlot[l].series[n].data=f;f=[]})}j=null})};function bw(){this.id=0;this.scaleFactor=0;this.np=[];this.updated=false}var bF=function(a,b){return Netdania.Utilities.dateFormat([parseInt(b)],a)};this.updateTickArray=function(a){if(this.timeScale==0){return true}else{if(Math.abs((Netdania.Utilities.dateFormat(bG[bG.length-1],"MM")-Netdania.Utilities.dateFormat(a,"MM")))>=this.timeScale){return true}}return false};this.getUpdateData=function(c,j){var e=this.chartType;if(this.timeScale==0){e=bj.LINE}var a=[];switch(e){case bj.LINEDOT:case bj.DOT:case bj.FOREST:case bj.LINE:case bj.AREA:var g=new Date(j*1000);var b=g.setMilliseconds(g.getMilliseconds());a[0]=b;this.updateTickArray(b);for(var h=0;h<c.length;h++){var f=c[h].f;switch(f){case 104:a[1]=c[h].v;break;case 105:a[2]=c[h].v;break}}break;case bj.HEIKINASHI:case bj.BAROHLC:case bj.CANDLESTICK:for(var h=0;h<c.length;h++){var f=c[h].f;switch(f){case 104:a[1]=c[h].v;break;case 100:var g=new Date(c[h].v*1000);var b=g.setMilliseconds(g.getMilliseconds());a[0]=b;this.updateTickArray(b);break;case 105:a[2]=c[h].v;break}}break;case bj.BARHLC:for(var h=0;h<c.length;h++){var f=c[h].f;switch(f){case 104:a[1]=c[h].v;break;case 100:var g=new Date(c[h].v*1000);var b=g.setMilliseconds(g.getMilliseconds());a[0]=b;this.updateTickArray(b);break;case 105:a[2]=c[h].v;break}}break;default:break}return a};this.update=function(c,e,b){var a=this.getUpdateData(c,e);if(this.relativeTo==false){this.updatePlot(a,b,this.chartPlot);if(aN.isZoomBarVisible&&this.id==b){this.updatePlotZoom(a,b)}if(aN.isVolumeVisible&&this.id==b){this.updatePlotVolume(a,b)}}else{this.updatePlotRelativeTo(a,b)}};this.getPlot=function(){return this.chartPlot};this.getVolumePlot=function(){return this.volumePlot};this.getZoomPlot=function(){return this.zoomPlot};this.getStudiesPlot=function(){return this.studiesPlot};this.replotPublic=function(b,c,f,a,e){bK(b,c,f,a,e)};var bK=function(b,c,f,a,e){c.clear=true;b.replot(c);if(a!==undefined&&e!==undefined){bc(b,f,a,e)}if(b.targetId.indexOf(aZ)!=-1){bc(b,f,a,e);a9(b,f)}};function aL(e,c){for(var f=0;f<c.length;f++){var b=c[f].plugins.cursor;var a=b.cursorCanvas._ctx;a.clearRect(0,0,a.canvas.width,a.canvas.height);b.shapeRenderer.draw(a,[[e.x,0],[e.x,a.canvas.height]],b.lineOptions);b=a=null}}this.attachChartListeners=function(b){$(b.targetId).unbind();$(b.target).unbind();var a=this;b.target.bind("jqplotZoom",function(j,l,n,k,g){aH=true;var q=g._zoom.axes.start;var f=Math.min(Math.round(parseFloat(q.xaxis)),Math.round(parseFloat(n.xaxis)));var c=Math.max(Math.round(parseFloat(q.xaxis)),Math.round(parseFloat(n.xaxis)));var h=((c-f)>aY)?aY:(c-f);var o=0;for(var m=0;m<k.series.length;m++){var e=k.series[m]._plotData.length;if(e>o){o=e}}if(c>=o-1){bb=true;for(var m=0;m<k.series.length;m++){if(k.series[m].label!=="study"){a.updatePricePointer(k.series[m]._plotData[k.series[m]._plotData.length-1][1],m,k.series[m].yaxis)}}}else{bb=false}aN.zoomState={gridpos:l,datapos:n,plot:k,cursor:g,numberPoints:h};bQ.zoomNumberOfPoints=h;bc(k,a);a9(k,a);$.jqplot.Trendline.drawTrendlines(k,a.getMainInstrument(),a.timeScale)});b.target.bind("jqplotResetZoom",function(e,f,c){aH=false;aN.zoomState=null;bb=true;bQ.zoomNumberOfPoints=aY;bc(b,a);a9(b,a);$.jqplot.Trendline.drawTrendlines(b,a.getMainInstrument(),a.timeScale)});b.target.bind("jqplotMouseEnter",function(f,h,g,e,c){bz(h,c,a)});b.target.bind("jqplotMouseMove",function(f,k,g,e,c){p=bu(k,c);bz(k,c,a);aX(c,p.xaxis,false);if(p.y2axis!==null){bv(c,p.y2axis,false)}if(p.yaxis!==null){a8(c,p.yaxis,false)}var h=[];if(a.getChartState().isVolumeVisible){h.push(a.volumePlot)}if(a.getChartState().noOfVisibleStudies>0){for(var j=0;j<a.studiesPlot.length;j++){h.push(a.studiesPlot[j])}}aL(k,h);h=null});b.target.bind("jqplotMouseLeave",function(f,h,g,e,c){bt(c,a);$(".nd-information-window").show()})};this.addInformationWindowPublic=function(b,a){bc(b,a)};function bc(k,f,g,e){if(bQ.showInformationWindow==false){return}var l=f.infoWindowTheme;var b=g||bn;$("#"+b).empty();$("#"+b).innerHTML="";$("#"+b).outerHTML="";$("#"+b).remove();var a=parseInt($(k.targetId).find(".jqplot-series-canvas").css("left").replace("px",""))+5+"px;";var c="margin-left:"+a+";";var h=5+"px";c+="margin-top:"+h+";";var j;if(e){var m=(l!==undefined)?l.colorStudy:"#FF0000";j='<span style="color:'+m+'" id="info-message">'+e+"</span>"}else{j=aU(k,l)}$('<div id="'+b+'" class="nd-information-window" style="'+c+'">'+j+"</div>").appendTo(k.target);$("[id*=nd-close-instrument-]").click(function(o){$("body").trigger("Custom.BeginWork");var n=this;setTimeout(function(){try{instrumentId=n.id.replace("nd-close-instrument-","");bl(instrumentId,f)}finally{$("body").trigger("Custom.EndWork")}},50)});j=c=h=a=null}function bT(e,a,c){var b=e.infoWindowTheme;var f=(b!==undefined)?b.colorStudy:"#FF0000";str='<span style="color:'+f+'">'+c+"</span>";$(a+" #info-message").html(str)}this.addCopyrightNoticePublic=function(b,a){a9(b,a)};function a9(c,a){return;var e=a.infoWindowTheme;$("#"+bB).empty();$("#"+bB).innerHTML="";$("#"+bB).outerHTML="";$("#"+bB).remove();var f=parseInt($(c.targetId).find(".jqplot-series-canvas").css("left").replace("px",""))+5+"px";var h="margin-left:"+f+";";var g=$("#"+aZ).height()-55+"px";h+="margin-top:"+g+";";var b="<a target='_blank' href='http://www.goldenstatemint.com' style='text-decoration: none;color:"+e.colorCopyright+"'>&copy;NetDania</a>";$('<div id="'+bB+'" class="nd-copyright-notice" style="'+h+'">'+b+"</div>").appendTo(c.target)}function a7(c,a){var e=a.infoWindowTheme;$("#"+aK).empty();$("#"+aK).innerHTML="";$("#"+aK).outerHTML="";$("#"+aK).remove();var f=parseInt($(c.targetId).find(".jqplot-series-canvas").css("left").replace("px",""))+5+"px";var h="margin-left:"+f+";";var g="5px";h+="margin-top:"+g+";";h+="color:"+e.colorStudy+";";var b="Volume";$('<div id="'+aK+'" class="nd-volume-label" style="'+h+'">'+b+"</div>").appendTo(c.target)}var bO=function(b){if(bH.toolbarTimescales!==undefined){var a="";$(bH.toolbarTimescales).each(function(f,c){var e=c.split("|");if(b==e[1]&&e[2]==bH.numberOfPoints){a=e[0]}});if(a!==""){return a}}switch(b){case 0:return"Ticks";break;case 1:return"1 Minute";break;case 5:return"5 Minutes";break;case 10:return"10 Minutes";break;case 15:return"15 Minutes";break;case 30:return"30 Minutes";break;case 60:return"1H";break;case 120:return"2H";break;case 480:return"8H";break;case 1440:return"Daily";break;case 10080:return"Weekly";break;case 43200:return"Monthly";break;default:return b;break}};function aU(c,e){var f=c.plugins.cursor.followMouse&&!(c.plugins.trendlineOverlay!==undefined&&c.plugins.trendlineOverlay.trendlines.length>0);var b="";var a="";$(by).each(function(l,h){var m=(e!==undefined)?e.color:"#000000";var o="nd-infoW-"+h.id;var k="nd-close-instrument-"+h.id;switch(h.type){case a5.MainInstrument:b+='<div style="float:left;" id="'+o+'" ><span style="color:'+m+'">'+h.name+", "+bO(bH.timescale);b+="</span></div>";break;case a5.Overlay:var g=(e!==undefined)?e.colorOverlay:"#000000";b+='<div style="float:left" id="'+o+'"><span style="color:'+m+';float: left;">,</span><span style="color:'+g+';">&nbsp'+h.name+"</span>";b+='<span style="float: '+(Netdania.Utilities.isBelowIEX(8)?"left":"right")+'" class="nd-close-button" id="'+k+'" ><span style="margin-left:5px; margin-top: -2px" class="ui-icon ui-icon-closethick"></span></span></div>';break;case a5.StudyOverlay:var j=h.paramColor;if(f){b+='<div style="float:left" id="'+o+'"><span style="color:'+m+';float: left;">,</span><span style="color:'+j+';">&nbsp'+h.name+"</span>";b+='<span style="float: right" class="nd-close-button" id="'+k+'" ><span style="margin-left:5px; margin-top: -2px" class="ui-icon ui-icon-closethick"></span></span></div>'}else{a+='<tr id="'+o+'" style="width:100%"><td><span style="color:'+j+';float: left;width:30px">'+h.name+"</span>";a+='<span style="float: left" id="info-message"></span><span style="float: left" class="nd-close-button" id="'+k+'" ><span style="margin-left:5px; margin-top: -2px" class="ui-icon ui-icon-closethick"></span></span></td></tr>'}break;case a5.RelativeTo:var n=(e!==undefined)?e.colorRelativeTo:"#000000";b+='<div style="float:left" id="'+o+'"><span style="color:'+m+';float: left;">,</span><span style="color:'+n+';">&nbsp'+h.name+"</span>";b+='<span style="float: '+(Netdania.Utilities.isBelowIEX(8)?"left":"right")+'" class="nd-close-button" id="'+k+'" ><span style="margin-left:5px; margin-top: -2px" class="ui-icon ui-icon-closethick"></span></span></div>';break}});b="<div >"+b+"</div>";if(a!==""){b='<table cellspacing="0" cellpadding="0" ><tr><td>'+b+"</td></tr>"+a+"</table>"}return b}this.removeAllInstrumentExceptMainInstrument=function(b){bs=[];var a=[];$(by).each(function(f,c){if(c.type!==a5.MainInstrument){var e=Netdania.Utilities.findIndex(b.ids,c.id);if(e!=""){b.ids.splice(e,1);connection.removeRequests([c.id])}}else{c.chartType=b.chartType;c.plotOptions=c.setOptions(b.chartType);c.data=c.setDataForChartType(c.ohlc,b.chartType);a.push(c)}});by=a;b.overlay=b.relativeTo=false;a6(b);bA(b);aQ(b);a2(b);aN.setVolumeVisibility(false);aN.setZoomBarVisibility(false);b.drawInitialChart(by)};function bl(b,a){$(by).each(function(f,c){if(c.id==b){var e=Netdania.Utilities.findIndex(a.ids,b);if(e!=""){a.ids.splice(e,1);connection.removeRequests([b])}by.splice(f,1);if(c.type===a5.Overlay){a.overlay=false;a.disableTicksButton(false)}else{if(c.type===a5.RelativeTo){a.relativeTo=false;bC=[];a.disableMenu("Relative",false);a.disableMenu("Studies",false);a.disableMenu("Lines",false);a.disableTimescalesBar(false)}}}else{if(c.type==a5.MainInstrument){c.chartType=a.chartType;c.plotOptions=c.setOptions(a.chartType);c.data=c.setDataForChartType(c.ohlc,a.chartType)}}});$.jqplot.Trendline.removeTrendlineMode(a.chartPlot);a.drawInitialChart(by)}this.init=function(c,b){aY=c[0].v.length;var e;var h=null;var j=null;var a=this;$(by).each(function(l,k){if(k.id==b){k.setOHLC(c);e=k}if(k.type==a5.Zoom){h=k}if(k.type==a5.MainInstrument){j=k}if(k.type==a5.StudyOverlay&&k.instrumentId==b){k.setOHLC(c);k=a.computeStudyOverlay(k,j.ohlc,j.data)}});switch(e.type){case a5.RelativeTo:var f=this.intersection(j,e);var g=new bw();g.id=j.id;j.data=this.filter(f,j,g);bC.push(g);var g=new bw();g.id=b;e.data=this.filter(f,e,g);bC.push(g);j.plotOptions=j.setOptions(bj.LINE);e.plotOptions={showMarker:false,color:"#FF007F",lineWidth:0.5};j.plotOptions.axes[j.plotOptions.seriesDefaults.yaxis]={tickOptions:{formatString:"%.2f %"},fontSize:"10px",formatStringTooltip:"%."+j.decimals+"f"};break;case a5.Overlay:e=this.setOverlayData(e,j);e.plotOptions={yaxis:(bQ.vaxis=="left")?"y2axis":"yaxis",showMarker:false,color:this.infoWindowTheme.colorOverlay,lineWidth:0.7};j.plotOptions.axes[e.plotOptions.yaxis]={tickOptions:{showGridline:false,formatString:"%."+e.decimals+"f",formatStringTooltip:"%."+e.decimals+"f"}};break;case a5.MainInstrument:if(h!==null){h.setOHLC(c)}break;default:break}if(!((this.overlay&&e.type!==a5.Overlay)||(this.relativeTo&&e.type!==a5.RelativeTo))){this.drawInitialChart(by)}c=null};var bR=function(){var b=$.cookie("jquery-ui-theme");var a="FFFFFF";switch(b){case"Overcast":a="FFFFFF";break;case"Smoothness":a="#eee";break;case"UI lightness":a="#FEFCEF";break;case"UI darkness":a="#000";break;case"Start":a="#CCE0ED";break;default:a="#FF0000"}return a};this.setTheme=function(a,c){var b;switch(a){case"chart":b={series:[{color:c.chartColor,rendererOptions:{upBodyColor:(c.candleStickColors!==undefined&&c.candleStickColors[0]!==undefined)?c.candleStickColors[0]:"#0000ff",downBodyColor:(c.candleStickColors!==undefined&&c.candleStickColors[1]!==undefined)?c.candleStickColors[1]:"#ff0000",fillUpBody:(c.candleStickColors!==undefined&&c.candleStickColors[2]!==undefined)?c.candleStickColors[2]:"#0000ff",fillDownBody:(c.candleStickColors!==undefined&&c.candleStickColors[3]!==undefined)?c.candleStickColors[3]:"#ff0000",wickColor:(c.candleStickColors!==undefined&&c.candleStickColors[4]!==undefined)?c.candleStickColors[4]:"#000000",lineWidth:0.7}},{}],grid:{backgroundColor:c.backgroundColor,gridLineColor:c.gridLineColor||"#999",borderColor:c.gridLineColor||"#999"},cursor:{linesColor:c.lineColor},axesDefaults:{tickOptions:{textColor:c.axisColor||"#999"}},axes:{xaxis:{tickOptions:{textColor:c.axisColor||"#999"}}},axesStyles:{ticks:{textColor:c.axisColor||"#999"}},fillBetween:c.fillBetween,trendlineColor:c.trendlineColor};break;case"volume":b={series:[{rendererOptions:{color:c.volumeColor,barPadding:10,barWidth:2,varyBarColor:false,shadow:false,fillStyle:c.volumeColor,showMarker:false}}],grid:{backgroundColor:c.backgroundColor},cursor:{linesColor:c.lineColor}};break;case"zoom":b={series:[{fillColor:c.zoomColor,color:c.zoomColor}],grid:{backgroundColor:c.backgroundColor,gridLineColor:c.gridLineColor||"#999",borderColor:c.gridLineColor||"#999"}};break;default:b={grid:{backgroundColor:c.backgroundColor},cursor:{linesColor:c.lineColor},axesDefaults:{tickOptions:{textColor:c.axisColor||"#999"}},axes:{xaxis:{tickOptions:{textColor:c.axisColor||"#999"}}},axesStyles:{ticks:{textColor:c.axisColor||"#999"}}}}return b};this.setInfoWindowTheme=function(a){this.infoWindowTheme.color=a.color;this.infoWindowTheme.colorOverlay=a.colorOverlay||"#ff0000";this.infoWindowTheme.colorRelativeTo=a.colorRelativeTo||"#FF007F";this.infoWindowTheme.colorStudy=a.colorStudy||"#FF0000";this.infoWindowTheme.colorCopyright=a.colorCopyright||"#999";this.infoWindowTheme.colorTooltip=a.colorTooltip||"#EEE"};this.registerThemes=function(b,a,c,e){switch(c){case"Smoothness":if(e){b.themeEngine.newTheme("Smoothness",this.setTheme(a,bE.Smoothness))}break;case"UI darkness":if(e){b.themeEngine.newTheme("UI darkness",this.setTheme(a,bE.UIdarkness))}break;case"UI lightness":if(e){b.themeEngine.newTheme("UI lightness",this.setTheme(a,bE.UIlightness))}break;case"Start":if(e){b.themeEngine.newTheme("Start",this.setTheme(a,bE.Start))}break}};this.changeChartBg=function(){$(".nd-chartPlot").css("background-color",bR())};this.changeTheme=function(b,h,e,g){var f=$.cookie("jquery-ui-theme");$.jqplot.Trendline.removeTrendlineMode(b);if(b!=null){this.changeChartBg()}if(b!==undefined&&b.themeEngine.get(f)===undefined){this.registerThemes(b,h,f,true)}this.setInfoWindowTheme(ba[f.replace(" ","")]);if(b!=null){try{if(e){if(g){aN.setVolumeThemeActive(false);aN.setStudyThemeActive(false);aN.setZoomThemeActive(false)}var c=b.themeEngine.get(f);for(var j=0;j<b.series.length;j++){if(c.series[j]!=undefined&&c.series[j].rendererOptions!==undefined){b.series[j].renderer.init.call(b.series[j],c.series[j].rendererOptions,b)}}if(b.fillBetween!==undefined){b.fillBetween.color=bE[f.replace(" ","")].fillBetween}$.jqplot.Trendline.lineOpts.color=$.jqplot.Trendline.markerOpts.color=bE[f.replace(" ","")].trendlineColor;if(h=="zoom"){bx(b,f,this);return}else{b.activateTheme(f)}if(c.cursor!==undefined){b.plugins.cursor.lineOptions.color=c.cursor.linesColor}}if(this.infoWindowTheme!==undefined){a9(b,this);bc(b,this)}if(b.plugins.trendlineOverlay!==undefined){$.jqplot.Trendline.drawTrendlines(b,this.getMainInstrument(),this.timeScale)}}catch(a){this.registerThemes(b,h,"Smoothness")}}};function bx(j,a,e){var q=j.themeEngine;var f=false;if(!a&&q.activeTheme&&q.activeTheme._name){a=q.activeTheme._name}if(!q.themes.hasOwnProperty(a)){throw new Error("No theme of that name")}else{var r=q.themes[a];q.activeTheme=r;var n,g=false,k=false;var l=["xaxis","x2axis","yaxis","y2axis"];for(m=0;m<l.length;m++){var b=l[m];if(r.axesStyles.borderColor!=null){j.axes[b].borderColor=r.axesStyles.borderColor}if(r.axesStyles.borderWidth!=null){j.axes[b].borderWidth=r.axesStyles.borderWidth}}for(var o in r.grid){if(r.grid[o]!=null){j.grid[o]=r.grid[o]}}if(!f){j.grid.draw()}var m;for(m=0;m<r.series.length;m++){var c={};var h=false;for(o in r.series[m]){n=(r.seriesStyles[o]!=null)?r.seriesStyles[o]:r.series[m][o];if(n!=null){c[o]=n;if(o=="color"){j.series[m].renderer.shapeRenderer.fillStyle=n;j.series[m].renderer.shapeRenderer.strokeStyle=n;j.series[m][o]=n}else{if((o=="lineWidth")||(o=="linePattern")){j.series[m].renderer.shapeRenderer[o]=n;j.series[m][o]=n}else{if(o=="markerOptions"){merge(j.series[m].markerOptions,n);merge(j.series[m].markerRenderer,n)}else{j.series[m][o]=n}}}f=true}}}if(f){j.drawSeries()}for(o in r.target){if(r.target[o]!=null){j.target.css(o,r.target[o])}}}}this.changeTimescale=function(g,b){this.setLoadingVisibility(true);this.timeScale=parseInt(g);var c=this.chartType;if(this.timeScale===0){c=bj.LINE;var a=[];for(var e=0;e<by.length;e++){if(by[e].type==a5.MainInstrument||by[e].type==a5.Zoom){a.push(by[e])}}by=a;a=null}bH.timescale=a0=this.timeScale;connection.removeRequests(this.ids);a6(this);a2(this);bs=[];bA(this);aQ(this);var f=[];this.ids=[];var a=[];for(var e=0;e<by.length;e++){switch(by[e].type){case a5.Zoom:by.splice(e,1);break;case a5.MainInstrument:if(b!==undefined){bH.numberOfPoints=bL=parseInt(b);bQ.zoomNumberOfPoints=(bH.defaultZoomNumberOfPoints!==undefined)?bH.defaultZoomNumberOfPoints:aY}f.push(Netdania.JsApi.Request.getReqObjChart(by[e].symbol,this.timeScale,bL,by[e].provider,true));this.ids.push(Netdania.JsApi.globalCurrentReqId);by[e].id=Netdania.JsApi.globalCurrentReqId;this.id=Netdania.JsApi.globalCurrentReqId;by[e].chartType=c;a.push(by[e]);break;case a5.Overlay:case a5.RelativeTo:f.push(Netdania.JsApi.Request.getReqObjChart(by[e].symbol,this.timeScale,bL,by[e].provider,true));this.ids.push(Netdania.JsApi.globalCurrentReqId);by[e].id=Netdania.JsApi.globalCurrentReqId;a.push(by[e]);break;case a5.Study:by[e].id=this.id;a.push(by[e]);bs.push(by[e]);break;case a5.StudyOverlay:by[e].id=this.id+"_s";by[e].instrumentId=this.id;a.push(by[e]);break;default:break}}by=a;a=null;aN.setNoOfVisibleStudies(bs.length);aW=this.id;if(aN.isZoomBarVisible){bq=new Instrument({id:aW,symbol:bH.symbol,name:name,provider:bH.provider,type:a5.Zoom,chartType:bj.ZOOM});by.push(bq)}connection.appendRequests(f);$.jqplot.Trendline.removeTrendlineMode(this.chartPlot)};this.changeInstrument=function(b,j){var e=-1;for(var a=0,c=bH.instruments.length;a<c;a++){if(typeof bH.instruments[a]==="string"&&bH.instruments[a].indexOf(bH.name)>-1){e=a}}var g=j===true?b.split("|"):bH.instruments[b].toString().split("|");bH.symbol=g[0];bH.name=g[1];bH.provider=g[2];Netdania.Utilities.setCursorByID(this.chartPlot.targetId,"crosshair");a6(this);bA(this);aQ(this);a2(this);connection.removeRequests(this.ids);aN.setTrendlineMode(false);var h=[];this.ids=[];var f=[];var k=[];for(var a=0;a<by.length;a++){switch(by[a].type){case a5.MainInstrument:h.push(Netdania.JsApi.Request.getReqObjChart(bH.symbol,this.timeScale,bL,bH.provider,true));by[a].symbol=bH.symbol;by[a].provider=bH.provider;by[a].decimals=g[3];by[a].name=bH.name;this.ids.push(Netdania.JsApi.globalCurrentReqId);by[a].id=Netdania.JsApi.globalCurrentReqId;this.id=Netdania.JsApi.globalCurrentReqId;f.push(by[a]);break;case a5.Study:by[a].id=this.id;f.push(by[a]);k.push(by[a]);default:break}}by=f;f=null;aN.setNoOfVisibleStudies(k.length);aW=this.id;if(aN.isZoomBarVisible){bq=new Instrument({id:aW,symbol:bH.symbol,name:name,provider:bH.provider,type:a5.Zoom,chartType:bj.ZOOM});by.push(bq)}this.overlay=this.relativeTo=false;connection.appendRequests(h);g=null;this.disableTicksButton(false);this.disableTimescalesBar(false);this.disableMenu("Relative",false);this.disableMenu("Studies",false);this.disableMenu("Lines",false);this.hideCurrentInstrumentFromMenu("Overlay",e,b);this.hideCurrentInstrumentFromMenu("Relative",e,b);this.setLoadingVisibility(true);$.jqplot.Trendline.removeTrendlineMode(this.chartPlot)};this.changeChartType=function(c,b){var a=this;$("body").trigger("Custom.BeginWork");setTimeout(function(){try{if(a.relativeTo){aS("Error","Cannot change chart type for relative to!");return}else{a6(a);bA(a);aQ(a);a2(a);$.jqplot.Trendline.removeTrendlineMode(a.chartPlot);if(a.timeScale==0&&c!=bj.LINE){a.timeScale=a0=1;b.selectTimescale(1);a.changeTimescale(1,a.getConfig().defaultNoOfPoints);connection.removeRequests(a.ids);a.ids=[];var e=[];for(var f=0;f<by.length;f++){if(by[f].type==a5.MainInstrument){by[f].ohlc=[];by[f].dateTimeArr=[];by[f].volume=null;e.push(Netdania.JsApi.Request.getReqObjChart(by[f].symbol,a.timeScale,bL,by[f].provider,true));a.id=by[f].id=Netdania.JsApi.globalCurrentReqId;by[f].chartType=c;a.chartType=c}a.ids.push(by[f].id)}connection.appendRequests(e)}else{for(var f=0;f<by.length;f++){if(by[f].type==a5.MainInstrument){by[f].chartType=c;a.chartType=c;by[f].data=by[f].setDataForChartType(by[f].ohlc,c);by[f].plotOptions=by[f].setOptions(c)}}a.drawInitialChart(by)}}if(a.trendLineComp&&(c===bj.DOT||c===bj.FOREST||c===bj.LINE||c===bj.LINEDOT)){a.disableMenuOptions(a.trendLineComp,[1,2,5,6])}else{if(a.trendLineComp){a.rebindEvents(a.trendLineComp,[1,2,5,6])}}}finally{$("body").trigger("Custom.EndWork")}},50)};var bf=function(){var a=false;$(by).each(function(c,b){if(b.type===a5.Overlay){a=true}});return a};this.addOverlay=function(b,c){var h=bH.instrumentsOverlay[b].toString().split("|");if(h[0]!==bH.symbol){this.setLoadingVisibility(true,true);this.overlay=true;this.relativeTo=false;a6(this);bA(this);aQ(this);a2(this);bG=[];bs=[];connection.removeRequests(this.ids);this.ids=[];var e=[];if(this.timeScale==0){bH.timescale=this.timeScale=a0=1;c.selectTimescale(1)}var a=[];for(var f=0;f<by.length;f++){switch(by[f].type){case a5.Zoom:case a5.Overlay:case a5.RelativeTo:break;case a5.MainInstrument:e.push(Netdania.JsApi.Request.getReqObjChart(by[f].symbol,this.timeScale,bL,by[f].provider,true));this.ids.push(Netdania.JsApi.globalCurrentReqId);by[f].id=Netdania.JsApi.globalCurrentReqId;by[f].chartType=this.chartType;this.id=Netdania.JsApi.globalCurrentReqId;a.push(by[f]);break;case a5.Study:by[f].id=this.id;a.push(by[f]);bs.push(by[f]);break;case a5.StudyOverlay:by[f].instrumentId=this.id;a.push(by[f]);break;default:break}}by=a;a=null;e.push(Netdania.JsApi.Request.getReqObjChart(h[0],this.timeScale,bL,h[2],true));this.ids.push(Netdania.JsApi.globalCurrentReqId);var g=new Instrument({id:Netdania.JsApi.globalCurrentReqId,symbol:h[0],name:h[1],provider:h[2],type:a5.Overlay,decimals:h[3],color:"#ffffff"});by.push(g);aW=this.id;if(aN.isZoomBarVisible){bq=new Instrument({id:aW,symbol:bH.symbol,name:name,provider:bH.provider,type:a5.Zoom,chartType:bj.ZOOM});by.push(bq)}connection.appendRequests(e);this.setLoadingVisibility(true)}else{aS("Error","Cannot overlay the same instrument!");return}h=null;this.disableMenu("Relative",false);this.disableMenu("Studies",false);this.disableMenu("Lines",false);this.disableTimescalesBar(false);this.disableTicksButton(true);$.jqplot.Trendline.removeTrendlineMode(this.chartPlot)};this.addStudy=function(b,c,a){if(this.timeScale==0&&c!==undefined){bH.timescale=this.timeScale=a0=1;c.selectTimescale(1)}if(checkIfStudyIsAdded(Netdania.StudyTypes[b])===true){aS("Error","This study is already added!");return}else{if(this.createStudy(Netdania.StudyTypes[b],a)!==false){this.setLoadingVisibility(true)}}$.jqplot.Trendline.removeTrendlineMode(this.chartPlot)};this.removeOverlay=function(){this.overlay=false;connection.removeRequests(this.ids.splice(1,1));this.ids=this.ids.splice(0);this.changeInstrument(bH.symbol);$.jqplot.Trendline.removeTrendlineMode(this.chartPlot)};this.addRelativeTo=function(b,c){var g=bH.instrumentsRelativeTo[b].toString().split("|");if(g[0]!==bH.symbol){this.overlay=false;this.relativeTo=true;a6(this);bA(this);aQ(this);a2(this);$.jqplot.Trendline.removeTrendlineMode(this.chartPlot);if(this.timeScale==0){bH.timescale=this.timeScale=a0=1;c.selectTimescale(1)}bG=[];bs=[];connection.removeRequests(this.ids);this.ids=[];var e=[];var a=[];for(var f=0;f<by.length;f++){switch(by[f].type){case a5.Zoom:case a5.Overlay:case a5.RelativeTo:break;case a5.MainInstrument:e.push(Netdania.JsApi.Request.getReqObjChart(by[f].symbol,this.timeScale,bL,by[f].provider,true));this.ids.push(Netdania.JsApi.globalCurrentReqId);by[f]=new Instrument({id:Netdania.JsApi.globalCurrentReqId,symbol:bH.symbol,provider:bH.provider,type:a5.MainInstrument,name:bH.name});this.id=Netdania.JsApi.globalCurrentReqId;a.push(by[f]);break;case a5.Study:by[f].id=this.id;a.push(by[f]);bs.push(by[f]);default:break}}by=a;e.push(Netdania.JsApi.Request.getReqObjChart(g[0],this.timeScale,bL,g[2],true));this.ids.push(Netdania.JsApi.globalCurrentReqId);by.push(new Instrument({id:Netdania.JsApi.globalCurrentReqId,symbol:g[0],name:g[1],provider:g[2],type:a5.RelativeTo,decimals:2}));aW=this.id;if(aN.isZoomBarVisible){bq=new Instrument({id:aW,symbol:bH.symbol,name:name,provider:bH.provider,type:a5.Zoom,chartType:bj.ZOOM});by.push(bq)}connection.appendRequests(e);this.setLoadingVisibility(true);this.disableTimescalesBar(true);this.disableMenu("Relative",true);this.disableMenu("Studies",true);this.disableMenu("Lines",true)}else{aS("Error","Cannot add relative to the same instrument!");return}};this.removeVolume=function(b){aN.setVolumeVisibility(false);$("#"+bU).unbind();$("#"+bU).innerHTML="";$("#"+bU).outerHTML="";$("#"+bU).remove();this.volumePlot.destroy();this.volumePlot=null;if(!b){bd(this);var a=this;if(aN.isZoomBarVisible){$.jqplot.Cursor.zoomProxy(a.chartPlot,a.zoomPlot,true);bm(a.zoomPlot,bQ.zoomNumberOfPoints,a,false)}else{bm(a.chartPlot,bQ.zoomNumberOfPoints,a,false)}}$.jqplot.Trendline.removeTrendlineMode(this.chartPlot)};this.addVolume=function(c){var b=aN.isVolumeVisible;$("body").trigger("Custom.BeginWork");var a=this;setTimeout(function(){try{var k="nd-close-"+bU;if($("#"+bU).length){$("#"+bU).empty();$("#"+bU).innerHTML="";$("#"+bU).outerHTML="";$("#"+bU).remove()}if($("#nd-clear-"+k).length){$("#nd-clear-"+k).empty();$("#nd-clear-"+k).innerHTML="";$("#nd-clear-"+k).outerHTML="";$("#nd-clear-"+k).remove()}if($("#"+k).length){$("#"+k).empty();$("#"+k).innerHTML="";$("#"+k).outerHTML="";$("#"+k).remove()}if(!b){aN.setVolumeVisibility(true);var m=$("#"+aZ+" .jqplot-axis.jqplot-yaxis").width();var f=$("#"+aZ+" .jqplot-axis.jqplot-y2axis").width();var l=$("#"+aZ).width();if(a.overlay){$('<div id="'+bU+'" style="height:'+aN.getVolumeChartHeight()+"%; width:"+(l-m-f)+"px !important; margin-left: "+m+'px;" class="volumeDiv"></div>').insertAfter("#"+aZ)}else{if(a.chartPlot.options.seriesDefaults.yaxis=="yaxis"){$('<div id="'+bU+'" style="height:'+aN.getVolumeChartHeight()+"%; width:"+(l-m)+"px !important; margin-left: "+m+'px;" class="volumeDiv"></div>').insertAfter("#"+aZ)}else{$('<div id="'+bU+'" style="height:'+aN.getVolumeChartHeight()+"%; width:"+(l-f)+'px !important" class="volumeDiv"></div>').insertAfter("#"+aZ)}}m=f=l=null;$(by).each(function(n,o){if(o.type==a5.MainInstrument){a.drawInitialVolumeChart(o.volume);return}});var k="nd-close-"+bU;bk(k,a,a.volumePlot,bU,"",function(){a.removeVolume(true)});if(aN.noOfVisibleStudies>0){var h=a.getStudies();for(var j=0;j<a.studiesPlot.length;j++){var e=parseInt(a.studiesPlot[j].targetId.replace("#nd-study-",""));$(a.studiesPlot[j].targetId).height(aN.getStudyChartHeight()+"%");bK(a.studiesPlot[j],{resetAxes:false},a,"nd-study-info"+e,h[j].studyName+": "+h[j].period+"="+a.studiesPlot[j].data[a.studiesPlot[j].data.length-1][1]);var k="nd-close-nd-study-"+e;var g=-a.studiesPlot[j].grid._plotDimensions.height+"px";$("#"+k).css("margin-top",g)}h=null}bd(a);if(aN.isZoomBarVisible){$("#"+bM).height(aN.getZoomChartHeight()+"%");var g=-a.zoomPlot.grid._plotDimensions.height+"px";$("#nd-close-"+bM).css("margin-top",g);$.jqplot.Cursor.zoomProxy(a.chartPlot,a.zoomPlot,true);bm(a.zoomPlot,bQ.zoomNumberOfPoints,a,false)}else{bm(a.chartPlot,bQ.zoomNumberOfPoints,a,false)}}else{aN.setVolumeVisibility(false);$("#"+bU).unbind();a.volumePlot.destroy();a.volumePlot=null;if(!c){bd(a);if(aN.isZoomBarVisible){$.jqplot.Cursor.zoomProxy(a.chartPlot,a.zoomPlot,true);bm(a.zoomPlot,bQ.zoomNumberOfPoints,a)}else{bm(a.chartPlot,bQ.zoomNumberOfPoints,a,false)}}}}finally{$("body").trigger("Custom.EndWork")}},50);$.jqplot.Trendline.removeTrendlineMode(this.chartPlot)};this.changePeriod=function(a){$.jqplot.Trendline.removeTrendlineMode(this.chartPlot);if(aN.isZoomBarVisible){bm(this.zoomPlot,a,this,true)}else{bm(this.chartPlot,a,this,true)}};this.showGridLines=function(b){$.jqplot.Trendline.removeTrendlineMode(this.chartPlot);switch(b){case"ShowV":aN.setVGridVisibility();this.chartPlot.axes.xaxis.tickOptions.showGridline=aN.isVGridVisible;bK(this.chartPlot,{resetAxes:false},this);$.jqplot.Trendline.drawTrendlines(this.chartPlot,this.getMainInstrument(),this.timeScale);for(var c=0;c<this.studiesPlot.length;c++){this.studiesPlot[c].axes.xaxis.tickOptions.showGridline=aN.isVGridVisible;bK(this.studiesPlot[c],{resetAxes:false},this)}if(aN.isVolumeVisible){this.volumePlot.axes.xaxis.tickOptions.showGridline=aN.isVGridVisible;bK(this.volumePlot,{resetAxes:false},this)}break;case"ShowH":aN.setHGridVisibility();this.chartPlot.axes[this.chartPlot.options.seriesDefaults.yaxis].tickOptions.showGridline=aN.isHGridVisible;bK(this.chartPlot,{resetAxes:false},this);$.jqplot.Trendline.drawTrendlines(this.chartPlot,this.getMainInstrument(),this.timeScale);for(var c=0;c<this.studiesPlot.length;c++){this.studiesPlot[c].axes[this.studiesPlot[c].options.seriesDefaults.yaxis].tickOptions.showGridline=aN.isHGridVisible;bK(this.studiesPlot[c],{resetAxes:false},this)}if(aN.isVolumeVisible){this.volumePlot.axes[this.volumePlot.options.seriesDefaults.yaxis].tickOptions.showGridline=aN.isHGridVisible;bK(this.volumePlot,{resetAxes:false},this)}break}for(var a=0;a<by.length;a++){by[a].updatePlotOptions()}};this.addTrendline=function(a){var b=$.cookie("jquery-ui-theme");b=(b!==undefined)?b.replace(" ",""):"UIdarkness";$.jqplot.Trendline.lineOpts.color=$.jqplot.Trendline.markerOpts.color=bE[b].trendlineColor;$.jqplot.Trendline.removeTrendlineMode(this.chartPlot);aN.setTrendlineMode(true);if(this.chartPlot.plugins.trendlineOverlay==undefined){$.jqplot.TrendlineOverlay.init(this.chartPlot,{instrument:this.getMainInstrument(),timescale:this.timeScale,type:a})}else{this.chartPlot.plugins.trendlineOverlay.instrument=this.getMainInstrument();this.chartPlot.plugins.trendlineOverlay.detachEventListeners(this.chartPlot);this.chartPlot.plugins.trendlineOverlay.detachEditEventListeners(this.chartPlot);this.chartPlot.plugins.trendlineOverlay.type=a;this.chartPlot.plugins.trendlineOverlay.attachEventListeners(this.chartPlot);this.chartPlot.plugins.trendlineOverlay.timescale=this.timeScale}};this.drawInitialChart=function(c){this.setLoadingVisibility(false,true);var b;if(this.chartPlot&&this.chartPlot.plugins.trendlineOverlay){b=this.chartPlot.plugins.trendlineOverlay.trendlines}var j=null;var m=null;var f=[];var o=[];var e=null;$("#"+aZ).empty();var k=0;for(var n=0;n<c.length;n++){if(c[n].type!=a5.Zoom&&c[n].type!=a5.Study&&c[n].type!=a5.StudyOverlay&&c[n].data!==undefined){o.push(c[n].data);c[n].index=k++}if(c[n].type==a5.MainInstrument){e=c[n].plotOptions;m=c[n]}else{if(c[n].type==a5.Zoom){j=c[n];if(j.data==undefined){j.initializeInstrument(m)}}else{if(c[n].type==a5.Study){f.push(c[n])}else{if(c[n].type==a5.StudyOverlay){c[n].index=k;for(var q=0;q<c[n].seriesCount;q++){o.push(c[n].series[q].data);e.series[e.series.length]=c[n].series[q].plotOptions;k++}if(c[n].fillBetween==true){var l=$.cookie("jquery-ui-theme");l=(l!==undefined)?l.replace(" ",""):"UIdarkness";e.fillBetween={series1:e.series.length-2,series2:e.series.length-1,color:bE[l].fillBetween,fill:true}}}else{if(c[n].plotOptions!==undefined){e.series[e.series.length]=c[n].plotOptions}}}}}}if(this.chartPlot){$("#"+aZ).unbind();this.chartPlot.destroy();this.chartPlot=null}$("#"+aZ).height(aN.computeMainChartHeight()+"%");this.chartPlot=$.jqplot(aZ,o,e);this.attachChartListeners(this.chartPlot);o=null;e=null;var a=m.data[m.data.length-1];if(aN.noOfVisibleStudies>0){bp(this,bs)}if(aN.isZoomBarVisible){bY=true;a1(this,true)}else{bm(this.chartPlot,bQ.zoomNumberOfPoints,this)}if(aN.isVolumeVisible){aV=true;aN.setVolumeVisibility(false);this.addVolume()}this.changeTheme(this.chartPlot,"chart",true);for(var n=0;n<c.length;n++){if((c[n].type==a5.MainInstrument||c[n].type==a5.Overlay)&&c[n].data!==undefined&&c[n].plotOptions!==undefined){var h=c[n].index;var a=c[n].ohlc[c[n].data.length-1];if(a===undefined){a=c[n].ohlc[c[n].ohlc.length-1]}this.updatePricePointer(a[4],h,this.chartPlot.series[h].yaxis);a=null}}var g=this;$(this.studiesPlot).each(function(t,r){for(var s=0;s<r.series.length;s++){g.updatePricePointer(r.series[s].data[r.series[s].data.length-1][1],s,r.series[s].yaxis,r)}});if(b!==undefined&&b.length>0){$.jqplot.TrendlineOverlay.reInit(this.chartPlot,{instrument:this.getMainInstrument(),timescale:this.timeScale,type:0},b);$.jqplot.Trendline.drawTrendlines(this.chartPlot,this.getMainInstrument(),this.timeScale)}d=co=null;this.setLoadingVisibility(false);this.saveState()};var aJ=function(){};var bA=function(a){if($("#"+bU).length){$("#"+bU).remove();a.volumePlot=null;$("#nd-close-"+bU).remove()}};var aQ=function(a){if($("#"+bM).length){$("#"+bM).remove();a.zoomPlot=null;$("#nd-close-"+bM).remove()}};var a2=function(){$('[id ^= "nd-study-"]').remove();$('[id ^= "nd-close-nd-study-"]').remove()};var a6=function(){if($("#"+aZ).length){$("#"+aZ).empty();self.chartPlot=null;if($(".pricePointer").length){$(".pricePointer").remove()}}};var bD=function(a){a.chartPlot.plugins.cursor.zoomProxy=false;a.chartPlot.plugins.cursor.zoomTarget=false;a.chartPlot.plugins.cursor.dblClickReset=true;try{a.zoomPlot.plugins.cursor.zoomProxy=false;a.zoomPlot.plugins.cursor.zoomTarget=false;a.zoomPlot.plugins.cursor.dblClickReset=true}catch(b){}};var bd=function(a){$("#"+aZ).height(aN.computeMainChartHeight()+"%");bK(a.chartPlot,{resetAxes:true},a)};var bk=function(k,e,j,f,a,c){$("#"+k).empty();$("#"+k).innerHTML="";$("#"+k).outerHTML="";var b="position:absolute;";var g="5px";b+="right:"+g+";";b+="left:"+e.chartPlot.grid._plotDimensions.width+"px;";var h=-j.grid._plotDimensions.height+"px";b+="margin-top:"+h+";";str='<span class="ui-icon ui-icon-closethick"></span>';$('<div class="nd-close-button" id="'+k+'" style="'+b+'">'+str+'</div><div id="nd-clear-'+k+'" style="clear:both;"></div>').insertAfter("#"+f);str=null;$("#"+k).click(function(){$("body").trigger("Custom.BeginWork");setTimeout(function(){try{be(k,e,j,f,a,c)}finally{$("body").trigger("Custom.EndWork")}},50)})};function be(k,e,j,f,b,c){if(b!=""){bs=Netdania.Utilities.removeArrayItemByValue(bs,b);by=Netdania.Utilities.removeArrayItemByValue(by,b)}$(j.targetId).unbind();j.destroy();j=null;$("#nd-clear-"+k).remove();$("#"+k).remove();c();var h=0;if(aN.noOfVisibleStudies>0){for(var l=0;l<e.studiesPlot.length;l++){var a=parseInt(e.studiesPlot[l].targetId.replace("#nd-study-",""));$(e.studiesPlot[l].targetId).height(aN.getStudyChartHeight()+"%");bK(e.studiesPlot[l],{resetAxes:false},e,"nd-study-info"+a,bs[l].studyName+": "+bs[l].period+"="+e.studiesPlot[l].data[e.studiesPlot[l].data.length-1][1]);var g="nd-close-nd-study-"+a;h=-e.studiesPlot[l].grid._plotDimensions.height+"px";$("#"+g).css("margin-top",h)}}if(aN.isVolumeVisible){$("#"+bU).height(aN.getVolumeChartHeight()+"%");bK(e.volumePlot,{resetAxes:false},e);var h=-e.volumePlot.grid._plotDimensions.height+"px";$("#nd-close-"+bU).css("margin-top",h)}if(aN.isZoomBarVisible){$("#"+bM).height(aN.getZoomChartHeight()+"%");bK(e.zoomPlot,{resetAxes:false},e);h=-e.zoomPlot.grid._plotDimensions.height+"px";$("#nd-close-"+bM).css("margin-top",h);bd(e);e.zoomPlot.target.unbind();e.chartPlot.target.unbind();e.attachChartListeners(e.chartPlot);$.jqplot.Cursor.zoomProxy(e.chartPlot,e.zoomPlot,true);bm(e.zoomPlot,bQ.zoomNumberOfPoints,e)}else{bd(e);e.chartPlot.plugins.cursor.zoomTarget=false;e.chartPlot.plugins.cursor.dblClickReset=true;if(aN.isVolumeVisible){$.jqplot.Cursor.zoomProxy(e.volumePlot,e.chartPlot,false,false)}if(aN.noOfVisibleStudies>0){for(var l=0;l<e.studiesPlot.length;l++){$.jqplot.Cursor.zoomProxy(e.studiesPlot[l],e.chartPlot,false,false)}}bm(e.chartPlot,bQ.zoomNumberOfPoints,e)}$.jqplot.Trendline.drawTrendlines(e.chartPlot,e.getMainInstrument(),e.timeScale)}var bp=function(a,b){a2();$(a.studiesPlot).each(function(e,c){$(c.targetId).unbind();c.target.unbind();c.destroy();c=null});a.studiesPlot=[];$(b).each(function(l,h){var c=h;if(c.data.length<c.period){aN.noOfVisibleStudies--;aS("Error","Not enough data! Study cannot be computed!")}else{var g;switch(c.studyName){case Netdania.StudyTypes.RSI.studyName:g=bV(c.data,0,c.data.length,c.period,null,c.decimals);c.plotOptions.series[0]={showMarker:false,color:c.seriesColors[0],lineWidth:0.5};break;case Netdania.StudyTypes.ROC.studyName:g=computeROC(c.data,0,c.data.length,c.period,null,c.decimals);c.plotOptions.series[0]={showMarker:false,color:c.seriesColors[0],lineWidth:0.5};break;case Netdania.StudyTypes.ATR.studyName:g=aI(c.ohlc,0,c.ohlc.length,c.period,null);c.plotOptions.series[0]={showMarker:false,color:c.seriesColors[0],lineWidth:0.5};break;case Netdania.StudyTypes.MACD.studyName:g=computeMACD(c.data,0,c.data.length,c.firstEMA,c.secondEMA,c.signalEMA,null,null,null);c.plotOptions.series[0]={showMarker:false,color:c.seriesColors[0],lineWidth:0.5};c.plotOptions.series[1]={showMarker:false,color:c.seriesColors[1],lineWidth:0.5};c.plotOptions.series[2]={renderer:$.jqplot.CustomBarRenderer,rendererOptions:{color:c.seriesColors[2],barPadding:10,barWidth:2,varyBarColor:false,shadow:false,fillStyle:c.seriesColors[2],showMarker:false,fillToZero:true,useNegativeColors:false}};break;case Netdania.StudyTypes.PKF.studyName:g=computePKF(c.ohlc,0,c.ohlc.length,c.period,c.averagingPeriodFast,null,null);c.plotOptions.series[0]={showMarker:false,color:c.seriesColors[0],lineWidth:0.5};c.plotOptions.series[1]={showMarker:false,color:c.seriesColors[1],lineWidth:0.5};break;case Netdania.StudyTypes.PKS.studyName:g=computePKS(c.ohlc,0,c.ohlc.length,c.period,c.averagingPeriodSlow,c.averagingPeriodFast,null,null);c.plotOptions.series[0]={showMarker:false,color:c.seriesColors[0],lineWidth:0.5};c.plotOptions.series[1]={showMarker:false,color:c.seriesColors[1],lineWidth:0.5};break;case Netdania.StudyTypes.MOM.studyName:g=computeMomentum(c.data,0,c.data.length,c.period,null);c.plotOptions.series[0]={showMarker:false,color:c.seriesColors[0],lineWidth:0.5};break;default:break}var q=$("#"+aZ).children(".jqplot-axis.jqplot-y2axis").width();var r=$("#"+aZ).children(".jqplot-axis.jqplot-yaxis").width();var j=$("#"+aZ).width();c.plotOptions.rightPadding=a.chartPlot._gridPadding.right;if(a.overlay&&bQ.vaxis!=="left"){$('<div id="nd-study-'+l+'" style="height:'+aN.getVolumeChartHeight()+"%; width:"+(j-r)+"px !important; margin-left: "+r+'px;" class="volumeDiv" ></div>').insertAfter("#"+aZ)}else{$('<div id="nd-study-'+l+'" style="height:'+aN.getVolumeChartHeight()+"%; width:"+j+'px !important;" class="volumeDiv"></div>').insertAfter("#"+aZ)}var o=[];var k=null;if(c.seriesCount==1){$(g).each(function(u,s){var t=[];t[0]=u;t[1]=parseFloat(s);o.push(t);t=null});k=$.jqplot("nd-study-"+l,[o],c.plotOptions)}else{$(g).each(function(u,s){var t=[];$(s).each(function(v,x){var w=[];w[0]=v;w[1]=parseFloat(x);t.push(w);w=null});o.push(t)});k=$.jqplot("nd-study-"+l,o,c.plotOptions)}g=null;a.studiesPlot.push(k);var e=c.name+": "+c.period+"=";for(var m=0;m<c.seriesCount;m++){e+='<span style="color:'+c.seriesColors[m]+'">'+k.series[m].data[k.series[m].data.length-1][1].toFixed(c.decimals)+"</span>";if(m<c.seriesCount-1){e+="/"}}k.target.bind("jqplotResetZoom",function(t,v,s){bc(k,a,"nd-study-info"+l,e);for(var u=0;u<k.series.length;u++){a.updatePricePointer(k.series[u].data[k.series[u].data.length-1][1],u,k.series[u].yaxis,k)}});k.target.bind("jqplotZoom",function(t,v,s){bc(k,a,"nd-study-info"+l,e);for(var u=0;u<k.series.length;u++){a.updatePricePointer(k.series[u].data[k.series[u].data.length-1][1],u,k.series[u].yaxis,k)}});k.target.bind("jqplotMouseMove",function(u,y,v,t,s){p=bu(y,s);bz(y,a.chartPlot,a);aX(a.chartPlot,p.xaxis,false);if(p.y2axis!==null){bv(s,p.y2axis,false)}if(p.yaxis!==null){a8(s,p.yaxis,false)}var w=[];w.push(a.chartPlot);if(a.getChartState().isVolumeVisible){w.push(a.volumePlot)}if(a.getChartState().noOfVisibleStudies>0){for(var x=0;x<a.studiesPlot.length;x++){if(a.studiesPlot[x]!==s){w.push(a.studiesPlot[x])}}}aL(y,w);w=null});k.target.bind("jqplotMouseLeave",function(u,w,v,t,s){bt(s,a)});a.changeTheme(k,"study",!aN.isStudyThemeActive);aN.setZoomThemeActive(true);$.jqplot.Cursor.zoomProxy(k,a.chartPlot,false,false);bc(k,a,"nd-study-info"+l,e);var n="nd-close-nd-study-"+l;var f="nd-study-"+l;bk(n,a,k,f,c.name,function(){$("#"+f).empty();$("#"+f).css("display","none");$("#nd-study-"+l).remove();$("#nd-study-"+l).html();$(k.targetId).unbind();k.destroy();k=null;a.studiesPlot=Netdania.Utilities.removeArrayItemByValue(a.studiesPlot,"#nd-study-"+l,"targetId");a.saveState()})}});$("#"+aZ).height(aN.computeMainChartHeight()+"%");bK(a.chartPlot,{resetAxes:true},a);a.setLoadingVisibility(aN.getLoadingVisibility())};this.addZoom=function(f){var e=this;bD(e);if(!aN.isZoomBarVisible){a6(this);a2(this);bs=[];bA(this);aQ(this);var b=[];this.ids=[];var a=[];for(var c=0;c<by.length;c++){switch(by[c].type){case a5.Zoom:by.splice(c,1);break;case a5.MainInstrument:b.push(Netdania.JsApi.Request.getReqObjChart(by[c].symbol,this.timeScale,1000,by[c].provider,true));this.ids.push(Netdania.JsApi.globalCurrentReqId);by[c].id=Netdania.JsApi.globalCurrentReqId;this.id=Netdania.JsApi.globalCurrentReqId;a.push(by[c]);break;case a5.Overlay:case a5.RelativeTo:b.push(Netdania.JsApi.Request.getReqObjChart(by[c].symbol,this.timeScale,1000,by[c].provider,true));this.ids.push(Netdania.JsApi.globalCurrentReqId);by[c].id=Netdania.JsApi.globalCurrentReqId;a.push(by[c]);break;case a5.Study:by[c].id=this.id;a.push(by[c]);bs.push(by[c]);break;case a5.StudyOverlay:by[c].id=this.id+"_s";by[c].instrumentId=this.id;a.push(by[c]);break;default:break}}by=a;a=null;aY=bL=1000;aN.setNoOfVisibleStudies(bs.length);aN.setZoomBarVisibility(true);connection.appendRequests(b);this.setLoadingVisibility(true)}else{a1(e,false)}$.jqplot.Trendline.removeTrendlineMode(this.chartPlot)};var a1=function(e,g,n){g=g||false;var l="nd-close-"+bM;if($("#"+bM).length){$("#"+bM).remove()}if($("#nd-clear-"+l).length){$("#nd-clear-"+l).remove()}$("#"+l).remove();if(aN.isZoomBarVisible&&!g){aN.setZoomBarVisibility(false);bd(e);if(aN.isVolumeVisible){$.jqplot.Cursor.zoomProxy(e.volumePlot,e.chartPlot,false,false)}bm(e.chartPlot,bQ.zoomNumberOfPoints,e);if(e.zoomPlot){e.zoomPlot.target.unbind();e.zoomPlot.destroy();e.zoomPlot=null}}else{aN.setZoomBarVisibility(true);var a=$(".jqplot-axis.jqplot-y2axis").width();var b=$(".jqplot-axis.jqplot-yaxis").width();var j=$("#nd-chartDiv"+e.componentId).width();if(e.overlay){$("#"+bQ.plotId+e.componentId).append('<div id="'+bM+'" style="height:'+aN.getZoomChartHeight()+"%; width: "+(j-a-b)+"px !important;margin-left: "+b+'px;" class="zoomBar"></div>')}else{if(e.chartPlot.options.seriesDefaults.yaxis=="yaxis"){$("#"+bQ.plotId+e.componentId).append('<div id="'+bM+'" style="height:'+aN.getZoomChartHeight()+"%; width:"+(j-b)+"px !important;margin-left: "+b+'px;" class="zoomBar"></div>')}else{$("#"+bQ.plotId+e.componentId).append('<div id="'+bM+'" style="height:'+aN.getZoomChartHeight()+"%; width:"+(j-a)+'px !important;" class="zoomBar"></div>')}}if(bq===null||(bq!==null&&bq.data==undefined)){bq=new Instrument({id:aW,symbol:bH.symbol,name:name,provider:bH.provider,type:a5.Zoom,chartType:bj.ZOOM});bq.initializeInstrument(e.getMainInstrument());by.push(bq)}if(e.zoomPlot){e.zoomPlot.target.unbind();e.zoomPlot.destroy();e.zoomPlot=null}e.zoomPlot=$.jqplot(bM,[bq.data],bq.plotOptions);e.changeTheme(e.zoomPlot,"zoom",!aN.isZoomThemeActive);aN.setZoomThemeActive(true);e.chartPlot.target.unbind();e.attachChartListeners(e.chartPlot);$.jqplot.Cursor.zoomProxy(e.chartPlot,e.zoomPlot,true);bk(l,e,e.zoomPlot,bM,"",function(){e.zoomPlot.destroy();e.zoomPlot=null;a1(e,false,true);e.saveState()});if(aN.noOfVisibleStudies>0){var k=e.getStudies();for(var m=0;m<e.studiesPlot.length;m++){var c=parseInt(e.studiesPlot[m].targetId.replace("#nd-study-",""));$(e.studiesPlot[m].targetId).height(aN.getStudyChartHeight()+"%");bK(e.studiesPlot[m],{resetAxes:false},e,"nd-study-info"+c,k[m].studyName+": "+k[m].period+"="+e.studiesPlot[m].data[e.studiesPlot[m].data.length-1][1]);var l="nd-close-nd-study-"+c;var h=-e.studiesPlot[m].grid._plotDimensions.height+"px";$("#"+l).css("margin-top",h);$.jqplot.Cursor.zoomProxy(e.studiesPlot[m],e.chartPlot,false,false)}k=null}if(aN.isVolumeVisible){if(e.volumePlot!=null){$("#"+bU).height(aN.getVolumeChartHeight()+"%");bK(e.volumePlot,{resetAxes:false},e);var h=-e.volumePlot.grid._plotDimensions.height+"px";$("#nd-close-"+bU).css("margin-top",h);$.jqplot.Cursor.zoomProxy(e.volumePlot,e.zoomPlot,true)}}bd(e);var f=bQ.zoomNumberOfPoints>aY?aY:bQ.zoomNumberOfPoints;bm(e.zoomPlot,f,e)}e.setLoadingVisibility(aN.getLoadingVisibility())};this.zoomDefaultPublic=function(b,e,a,c){bm(b,e,a,c)};function bm(h,g,m,v){var l=v||false;var g=bQ.zoomNumberOfPoints=g>aY?aY:g;if(l){if(aN.isZoomBarVisible){m.zoomPlot.resetZoom()}else{h.resetZoom()}}var w=h.plugins.cursor;var k=w.zoomCanvas._ctx;var b=(k.canvas.width*g)/aY;var c={x:k.canvas.width-b,y:10};var t=bu(c,h);w._zoom.gridpos=c;w._zoom.datapos=t;var f=h.axes;w._zoom.start=[c.x,0];w._zoom.started=true;for(var q in t){w._zoom.axes.start[q]=t[q]}w._zoom.end=[k.canvas.width,k.canvas.height];var s=w._zoom.start;var u=w._zoom.end;var k=w.zoomCanvas._ctx;var j,o,e,r;if(u[0]>s[0]){j=s[0];r=u[0]-s[0]}else{j=u[0];r=s[0]-u[0]}if(u[1]>s[1]){o=s[1];e=u[1]-s[1]}else{o=u[1];e=s[1]-u[1]}k.fillStyle=w.zoomOptions.fillStyle;k.strokeStyle=w.zoomOptions.strokeStyle;k.lineWidth=w.zoomOptions.lineWidth;k.clearRect(0,0,k.canvas.width,k.canvas.height);k.fillRect(0,0,k.canvas.width,k.canvas.height);k.clearRect(j,o,r,e);k.strokeRect(j,o,r,e);w.doZoom({x:0,y:0},bu({x:k.canvas.width,y:0},h),h,w);w=k=f=null;var n=$(".jqplot-handle-left",h.target);var a=h.plugins.cursor.dragHandle;n.css({position:"absolute",top:n.attr("top")+"px",left:(a.width/2)+c.x+"px"});n=a=null;$.jqplot.Trendline.drawTrendlines(m.chartPlot,m.getMainInstrument(),m.timeScale)}function bu(b,e){var a={xaxis:null,yaxis:null,x2axis:null,y2axis:null,y3axis:null,y4axis:null,y5axis:null,y6axis:null,y7axis:null,y8axis:null,y9axis:null,yMidAxis:null};var g=["xaxis","yaxis","x2axis","y2axis","y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis","yMidAxis"];var f=e.axes;var c,h;for(c=11;c>0;c--){h=g[c-1];if(f[h].show){a[h]=f[h].series_p2u(b[h.charAt(0)])}}f=null;return a}this.setOverlayData=function(c,j){var f=this.intersection(j,c);var b=c.data[0][1];var g=c.data[c.data.length-1][1];var e=[];var a=[];for(var h=0;h<j.data.length;h++){e.push([j.data[h][0],b]);a.push(j.dateTimeArr[h]);if($.inArray(j.data[h][0],f)>0){e[h][1]=b=c.data[$.inArray(j.data[h][0],f)][1]}}c.data=e;c.dateTimeArr=a;c.setdtArr(c.dateTimeArr);return c};this.disableTicksButton=function(a){$("#radio0nd-bottom"+this.componentId).button({disabled:a})};this.disableTimescalesBar=function(a){$("#timescalesnd-bottom"+this.componentId).buttonset({disabled:a})};this.disableMenu=function(b,a){groups=$("[id^=nd-ddl]");$.each(groups,function(f,e){inputs=$(e).children("span");if(inputs[0].innerHTML.indexOf(b)>=0){var c=$(e).attr("id").replace("nd-ddl","");$("#nd-ddl"+c).button({disabled:a});$("#nd-arr"+c).button({disabled:a})}})};this.hideCurrentInstrumentFromMenu=function(a,b,c){groups=$("[id^=nd-ddl]");$.each(groups,function(g,f){inputs=$(f).children("span");if(inputs[0].innerHTML.indexOf(a)>=0){var e=$(f).attr("id").replace("nd-ddl","");$("#nd-c-div"+e+" ul").find("#"+b).show();if(c){$("#nd-c-div"+e+" ul").find("#"+c).hide()}}})};var bh={};this.disableMenuOptions=function(b,a){this.rebindEvents(b,a);var c=this.chartPlot;var e=null;bh[b.ddlId]=[];$("#"+b.ulID+" li").each(function(g){if($.inArray(g,a)!==-1){span=$(this).find("span");span.addClass("ui-button-disabled ui-state-disabled nd-disabled");var h="";var f=null;$.each(span.data("events"),function(j,k){h=j;$.each(k,function(m,l){f=l.handler})});span.unbind();span.bind("click",function(){$.jqplot.Trendline.removeTrendlineMode(c)});e={itemNumber:g,evName:h,handler:f};bh[b.ddlId].push(e)}})};this.rebindEvents=function(b,a){$.each(bh,function(c,e){if(c===b.ddlId){$("#"+b.ulID+" li").each(function(g){var f=$(this).find("span");$(e).each(function(h,j){if(g===j.itemNumber){f.unbind();f.removeClass("ui-button-disabled ui-state-disabled nd-disabled");f.bind(j.evName,j.handler);delete bh[c]}})})}})};this.drawInitialVolumeChart=function(b){if(this.volumePlot){this.volumePlot.target.unbind();$("#"+bU).unbind();this.volumePlot.destroy();this.volumePlot=null}b.plotOptions.axes[b.plotOptions.seriesDefaults.yaxis].tickOptions.showGridline=aN.isVGridVisible;this.volumePlot=$.jqplot(bU,[b.data],b.plotOptions);var a=this;this.volumePlot.target.bind("jqplotMouseEnter",function(f,h,g,e,c){a7(a.volumePlot,a)});this.volumePlot.target.bind("jqplotMouseMove",function(f,k,g,e,c){p=bu(k,c);bz(k,a.chartPlot,a);if(p.y2axis!==null){bv(c,p.y2axis,false)}if(p.yaxis!==null){a8(c,p.yaxis,false)}aX(a.chartPlot,p.xaxis,false);var h=[];h.push(a.chartPlot);if(a.getChartState().noOfVisibleStudies>0){for(var j=0;j<a.studiesPlot.length;j++){if(a.studiesPlot[j]!==c){h.push(a.studiesPlot[j])}}}aL(k,h)});this.volumePlot.target.bind("jqplotMouseLeave",function(f,h,g,e,c){bt(c,a)});this.volumePlot.target.bind("jqplotZoom",function(g,h,e,f,c){a7(a.volumePlot,a)});this.volumePlot.target.bind("jqplotResetZoom",function(e,f,c){a7(a.volumePlot,a)});this.changeTheme(this.volumePlot,"volume",!aN.isVolumeThemeActive);aN.setVolumeThemeActive(true);if(!aN.isZoomBarVisible){$.jqplot.Cursor.zoomProxy(this.volumePlot,this.chartPlot,false,false)}else{$.jqplot.Cursor.zoomProxy(this.volumePlot,this.zoomPlot,true,true)}dp=b.data[b.data.length-1];$('<div id="'+bW+'" style="position:absolute;" class="pricePointer-y2axis"></div>').appendTo(this.volumePlot.target);this.updateVolumePointer(dp[1]);$.jqplot._noToImageButton=true;d=dp=co=null};this.isNewBar=function(c,b,a){var f;var e=false;$(by).each(function(h,g){if(g.id==b&&g.type==a){f=g}});if(Math.abs((Netdania.Utilities.dateFormat(f.dateTimeArr[f.dateTimeArr.length-1],"MM")-Netdania.Utilities.dateFormat(c[0],"MM")))>=this.timeScale){e=true;f.dateTimeArr.shift();f.dateTimeArr.push(c[0]);f.ohlc.shift();this.updateTicks(f.ohlc);f.ohlc.push([f.dateTimeArr.length-1,c[1],c[1],c[1],c[1],(c[2]!==undefined)?c[2]:0]);f.seed++;f.updateDtArray(c[0])}return e};this.isNewBarVolume=function(c,b){var a;var e=false;$(by).each(function(g,f){if(f.id==b){a=f}});if(Math.abs((Netdania.Utilities.dateFormat(a.volume.dateTimeArr[a.volume.dateTimeArr.length-1],"MM")-Netdania.Utilities.dateFormat(c[0],"MM")))>=this.timeScale){e=true;a.volume.dateTimeArr.shift();a.volume.dateTimeArr.push(c[0]);a.volume.seed++;a.volume.updateDtArray(c[0])}return e};this.updateTicks=function(b){for(var a=0;a<b.length;a++){b[a][0]=b[a][0]-1}};this.drawNewBar=function(l,g,f,j){var k=l.series[g].data;var e=this;var a=[];a[5]=0;a[0]=k[k.length-1][0]+1;a[1]=j[1];a[2]=j[1];a[3]=j[1];a[4]=j[1];k.shift();k.push(a);this.updateTicks(k);$.jqplot.Trendline.updateTrendlines(l,this.getMainInstrument(),e.timeScale);if(!bb||aN.isTrendlineMode){return}if(j[1]>l.axes[l.options.seriesDefaults.yaxis].max||((!l.axes[l.options.seriesDefaults.yaxis].forceMin0)&&j[1]<l.axes[l.options.seriesDefaults.yaxis].min)){var h=l.plugins.cursor;h.canZoom=true;if(l.targetId.indexOf(aZ)!=-1){bK(l,{resetAxes:true,clear:false},e)}else{bK(l,{resetAxes:false,clear:false},e)}if(bb&&aH&&aN.zoomState!==null){aN.zoomState.cursor.canZoom=true;h.doZoom(aN.zoomState.gridpos,aN.zoomState.datapos,l,aN.zoomState.cursor)}$.jqplot.Trendline.drawTrendlines(l,e.getMainInstrument(),e.timeScale)}else{if(this.timeScale==0){if(l.targetId.indexOf(aZ)!=-1){for(var c in l.axes){l.axes[c]._ticks=[]}var b=["xaxis","yaxis","y2axis"];var c=l.axes;for(i=0;i<3;i++){name=b[i];l.target.append(c[name].draw(l.baseCanvas._ctx,l));c[name].set()}c.xaxis.pack({position:"absolute",bottom:l._gridPadding.bottom-c.xaxis.getHeight(),left:0,width:l._width},{min:l._gridPadding.left,max:l._width-l._gridPadding.right});c.yaxis.pack({position:"absolute",top:0,left:l._gridPadding.left-c.yaxis.getWidth(),height:l._height},{min:l._height-l._gridPadding.bottom,max:l._gridPadding.top});c.y2axis.pack({position:"absolute",top:0,right:l._gridPadding.right-c.y2axis.getWidth()},{min:l._height-l._gridPadding.bottom,max:l._gridPadding.top})}l.drawSeries({},g);$.jqplot.Trendline.redrawTrendlines(l,this.getMainInstrument(),this.timeScale)}else{bK(l,{resetAxes:true},e);if(aN.isZoomBarVisible){bm(this.zoomPlot,bQ.zoomNumberOfPoints,this,true)}else{bm(this.chartPlot,bQ.zoomNumberOfPoints,this,true)}}}k=j=a=co=current=null};this.drawCurrentBar=function(e,c,h,f){if(!bb||aN.isTrendlineMode){return}var g=e.series[c].yaxis;var a=this;if((g.charAt(0)=="y")&&(f[2]>e.axes[g].max||f[3]<e.axes[g].min)){var b=e.plugins.cursor;b.canZoom=true;bK(e,{resetAxes:true},a);if(bb&&aH&&aN.zoomState!==null){aN.zoomState.cursor.canZoom=true;b.doZoom(aN.zoomState.gridpos,aN.zoomState.datapos,e,aN.zoomState.cursor)}this.updatePricePointer(f[4],c,g);$.jqplot.Trendline.drawTrendlines(e,this.getMainInstrument(),this.timeScale)}else{e.drawSeries({},undefined,true);this.updatePricePointer(f[4],c,g);if(aP){aP=false;$.jqplot.Trendline.redrawTrendlines(e,this.getMainInstrument(),this.timeScale)}}};this.updatePlot=function(s,h,e){var q=this.chartType;var t;$(by).each(function(D,C){if(C.id==h&&C.type!==a5.Zoom&&C.type!==a5.Study){q=C.chartType;t=C;return}});var v=t.index;var z=e.series[v].data;var a=e.series[v].yaxis;var g=z[z.length-1];var j=this;var u=this.isNewBar(s,h,t.type);if(u&&t.type===a5.MainInstrument){if(bb&&!aN.isTrendlineMode){this.computeStudies(t,z)}}switch(q){case bj.LINEDOT:case bj.DOT:case bj.LINE:case bj.AREA:switch(this.timeScale){case 0:this.drawNewBar(e,v,aR,s);this.updatePricePointer(s[1],v,a);break;default:if(!u){g[0]=z[z.length-1][0];g[1]=s[1];this.updateOHLC(t,s);this.drawCurrentBar(e,v,aR,[g[0],g[1],g[1],g[1],g[1]])}else{this.drawNewBar(e,v,aR,s)}break}break;case bj.FOREST:switch(this.timeScale){case 0:break;default:if(!u){g[0]=z[z.length-1][0];g[1]=s[1];this.updateOHLC(t,s);this.drawCurrentBar(e,v,aR,[g[0],g[1],g[1],g[1],g[1]])}else{this.drawNewBar(e,v,aR,s)}break}break;case bj.BAROHLC:case bj.CANDLESTICK:if(!u){var c=z.length,f=z[c-1][2],x=z[c-1][3],m=z[c-1][4];newval=s[1];if(newval>f){f=newval}else{if(newval<x){x=newval}}g[0]=z[c-1][0];g[1]=z[c-1][1];z[c-1][2]=g[2]=f;z[c-1][3]=g[3]=x;z[c-1][4]=g[4]=newval;this.updateOHLC(t,[g[2],g[3],g[4],s[2]]);this.drawCurrentBar(e,v,aR,g)}else{this.drawNewBar(e,v,aR,s)}break;case bj.HEIKINASHI:c=z.length;var b=z[c-2][1];var r=z[c-2][4];var l=z[c-1][1];var n=z[c-1][2];var w=z[c-1][3];var k=s[1];var y=l;var A=Math.max(Math.max(n,y),k);var B=Math.min(Math.min(w,y),k);var o=parseFloat(((y+A+B+k)/4).toFixed(bQ.currentInstrument.decimals));g[2]=A;g[3]=B;g[4]=o;if(!u){this.updateOHLC(t,[g[2],g[3],g[4],s[2]]);this.drawCurrentBar(e,v,aR,g)}else{this.drawNewBar(this.chartPlot,v,aR,s)}break;case bj.BARHLC:if(!u){c=z.length,f=z[c-1][1],x=z[c-1][2],m=z[c-1][3];newval=s[1];if(newval>f){f=newval}else{if(newval<x){x=newval}}g[1]=f;g[2]=x;g[3]=newval;this.updateOHLC(t,[g[1],g[2],g[3],s[2]]);this.drawCurrentBar(e,v,aR,[g[0],g[3],g[1],g[2],g[3]])}else{this.drawNewBar(this.chartPlot,v,aR,s)}break;default:break}if(u&&t.type===a5.MainInstrument){$(by).each(function(D,C){if(C.type===a5.StudyOverlay){j.recomputeStudyOverlay(C,t.ohlc,z,e)}})}z=g=c=s=null};this.updateOHLC=function(c,b){var a=c.ohlc[c.ohlc.length-1];switch(c.chartType){case bj.BAROHLC:case bj.CANDLESTICK:case bj.HEIKINASHI:case bj.BARHLC:a[2]=b[0];a[3]=b[1];a[4]=b[2];if(b[3]!==null&&b[3]!==undefined){a[5]+=b[3]}break;default:if(a[2]<b[1]){a[2]=b[1]}if(a[3]>b[1]){a[3]=b[1]}a[4]=b[1];if(b[2]!==null&&b[2]!==undefined){a[5]+=b[2]}}};this.updatePlotVolume=function(g,b){if(!bb||aN.isTrendlineMode){return}var f=this.volumePlot.series[0].data;g.splice(1,1);var a=this.isNewBarVolume(g,b);dl=f.length;if(this.timeScale==0){this.drawNewBar(this.volumePlot,0,bW,g);this.updateVolumePointer(g[1])}else{if(!a){var c=f[f.length-1];c[0]=f[f.length-1][0];c[1]+=g[1];if(c[1]>this.volumePlot.axes[this.volumePlot.options.seriesDefaults.yaxis].max){var e=this.volumePlot.plugins.cursor;e.canZoom=true;bK(this.volumePlot,{resetAxes:true},self);if(bb&&aH&&aN.zoomState!==null){aN.zoomState.cursor.canZoom=true;e.doZoom(aN.zoomState.gridpos,aN.zoomState.datapos,this.volumePlot,aN.zoomState.cursor)}}else{this.volumePlot.drawSeries({},0,true)}this.updateVolumePointer(c[1])}else{this.drawNewBar(this.volumePlot,0,bW,g);this.updateVolumePointer(g[1])}}f=c=g=co=null};this.updatePlotZoom=function(f,b){var a=[];a[0]=f[0];a[1]=f[1];var e=this.zoomPlot.series[0].data;var g=this.isNewBar(a,aW,a5.Zoom);switch(this.timeScale){case 0:this.drawNewZoomBar(this.zoomPlot,a);break;default:if(!g){var c=e[e.length-1];c[1]=f[1];if(c[1]>this.zoomPlot.axes[this.volumePlot.options.seriesDefaults.yaxis].max){bK(this.zoomPlot,{resetAxes:true},self);$.jqplot.Cursor.zoomProxy(this.chartPlot,this.zoomPlot,true);bm(this.zoomPlot,bQ.zoomNumberOfPoints,this)}}else{this.drawNewZoomBar(this.zoomPlot,a)}break}e=c=f=null};this.drawNewZoomBar=function(c,e){var b=c.series[0].data;var a=[];a[5]=0;a[0]=b[b.length-1][0]+1;a[1]=e[1];a[2]=e[1];a[3]=e[1];a[4]=e[1];b.shift();b.push(a);this.updateTicks(b);if(e[1]>c.axes[c.options.seriesDefaults.yaxis].max||((!c.axes[c.options.seriesDefaults.yaxis].forceMin0)&&e[1]<c.axes[c.options.seriesDefaults.yaxis].min)){bK(c,{resetAxes:true,clear:false},this);$.jqplot.Cursor.zoomProxy(this.chartPlot,c,true);bm(c,bQ.zoomNumberOfPoints,this,true)}else{c.drawSeries({},0)}b=e=a=null};this.updatePlotRelativeTo=function(g,c){var j;$(by).each(function(q,o){if(o.id==c&&o.type!==a5.Zoom){j=o;return}});var b=this.isNewBar(g,c,j.type);if(!b){var f=j.index;var h=this.chartPlot.series[f].data;var n=h[h.length-1];$(bC).each(function(){if(this.id==c){this.updated=true;var o=[];o[0]=g[0];o[1]=(g[1]/this.scaleFactor-1)*100;this.np=o}});this.updateOHLC(j,[g[1],g[1],g[1],g[1],g[2]]);h=n=g=co=null}else{var m=true;$(bC).each(function(){m=m&&this.updated;this.updated=false;return this});if(m){for(var l=0;l<bC.length;l++){this.drawNewBar(this.chartPlot,l,aR,bC[l].np)}var e=(aN.isZoomBarVisible)?this.zoomPlot.plugins.cursor._zoom.isZoomed:this.chartPlot.plugins.cursor._zoom.isZoomed;var k=(aN.isZoomBarVisible)?this.zoomPlot.plugins.cursor._zoom.gridpos:this.chartPlot.plugins.cursor._zoom.gridpos;var a=(aN.isZoomBarVisible)?this.zoomPlot.plugins.cursor._zoom.datapos:this.chartPlot.plugins.cursor._zoom.datapos;bK(this.chartPlot,{resetAxes:true},this);if(bb&&aH&&aN.zoomState!==null){aN.zoomState.cursor.canZoom=true;aN.zoomState.cursor.doZoom(aN.zoomState.gridpos,aN.zoomState.datapos,aN.zoomState.plot,aN.zoomState.cursor)}this.updatePricePointer(bC[0].np[1],0,this.chartPlot.options.seriesDefaults.yaxis)}}};this.updatePricePointer=function(b,f,g,j){if(!bb||aN.isTrendlineMode){return}if(j===undefined){j=this.chartPlot}if(f==undefined){f=0}var c=$("#"+aR+f+j.targetId.replace("#",""));if(c.length==0){$('<div id="'+aR+f+j.targetId.replace("#","")+'" style="position:absolute;" class="pricePointer-'+g+'"></div>').appendTo(j.target);c=$("#"+aR+f+j.targetId.replace("#",""))}var m;var a,e;if(g=="yaxis"){m=j.axes.yaxis;a="-7px"}else{m=j.axes.y2axis;a=j._gridPadding.left+j.grid._width+3+"px"}c.css("width",m._elem.css("width")+5);var l=$.jqplot.DefaultTickFormatter;var k=m.tickOptions.formatString;c.html(""+l(k,b));var h=m.u2p(b)-c.outerHeight()/2+"px";c.css({left:a,top:h});c=m=tick=str=a=h=null};this.updateVolumePointer=function(b){var c=$("#"+bW);var e=this.volumePlot.options.seriesDefaults.yaxis;if(c.length===0){$('<div id="'+bW+'" style="position:absolute;" class="pricePointer-'+e+'"></div>').appendTo(this.volumePlot.target)}var c=$("#"+bW);var k=this.volumePlot.axes[this.volumePlot.options.seriesDefaults.yaxis];var a=this.chartPlot.axes[this.chartPlot.options.seriesDefaults.yaxis];var h=k._ticks[0];if(e=="yaxis"){left="-"+(parseInt($("#"+bU).css("margin-left"))+7)+"px"}else{left=this.volumePlot._gridPadding.left+this.volumePlot.grid._width+3+"px"}c.css("width",a._elem.css("width"));var j=$.jqplot.DefaultTickFormatter;var g=k.tickOptions.formatString;c.html(""+j(g,b));var f=k.u2p(b)-c.outerHeight()/2+"px";c.css({left:left,top:f});c=k=h=str=left=f=null};function aT(C,b){var n=b.series;var E,a,e,h,g,o,r,s,z,u,q,w;var v,y,f,c,F,A;var t,j;for(e=b.seriesStack.length-1;e>=0;e--){E=b.seriesStack[e];h=n[E];switch(h.renderer.constructor){case $.jqplot.LineRenderer:o=C.x;r=C.y;g=h.renderer;if(h.show){if((h.fill||(h.renderer.bands.show&&h.renderer.bands.fill))&&(!b.plugins.highlighter||!b.plugins.highlighter.show)){var B=false;if(o>h._boundingBox[0][0]&&o<h._boundingBox[1][0]&&r>h._boundingBox[1][1]&&r<h._boundingBox[0][1]){var x=h._areaPoints.length;var k;var a=x-1;for(var k=0;k<x;k++){var l=[h._areaPoints[k][0],h._areaPoints[k][1]];var m=[h._areaPoints[a][0],h._areaPoints[a][1]];if(l[1]<r&&m[1]>=r||m[1]<r&&l[1]>=r){if(l[0]+(r-l[1])/(m[1]-l[1])*(m[0]-l[0])<o){B=!B}}a=k}}if(B){return{seriesIndex:E,pointIndex:null,gridData:h.gridData,data:h.data,points:h._areaPoints}}break}else{j=h.markerRenderer.size/2;t=(j>0)?j:0;for(var a=0;a<h.gridData.length;a++){f=h.gridData[a];if(g.constructor==$.jqplot.OHLCRenderer){if(g.candleStick){var D=h._yaxis.series_u2p;if(o>=f[0]-g._bodyWidth/2&&o<=f[0]+g._bodyWidth/2){return{seriesIndex:E,pointIndex:a,gridData:f,data:h.data[a]}}}else{if(!g.hlc){var D=h._yaxis.series_u2p;if(o>=f[0]-g._tickLength&&o<=f[0]+g._tickLength){return{seriesIndex:E,pointIndex:a,gridData:f,data:h.data[a]}}}else{var D=h._yaxis.series_u2p;if(o>=f[0]-g._tickLength&&o<=f[0]+g._tickLength){return{seriesIndex:E,pointIndex:a,gridData:f,data:h.data[a]}}}}}else{if(f[0]!=null&&f[1]!=null){y=Math.sqrt((o-f[0])*(o-f[0]));if(y<=t&&(y<=v||v==null)){v=y;return{seriesIndex:E,pointIndex:a,gridData:f,data:h.data[a]}}}}}}}break;default:o=C.x;r=C.y;g=h.renderer;if(h.show){j=h.markerRenderer.size/2;t=(j>0)?j:0;for(var a=0;a<h.gridData.length;a++){f=h.gridData[a];if(g.constructor==$.jqplot.OHLCRenderer){if(g.candleStick){var D=h._yaxis.series_u2p;if(o>=f[0]-g._bodyWidth/2&&o<=f[0]+g._bodyWidth/2){return{seriesIndex:E,pointIndex:a,gridData:f,data:h.data[a]}}}else{if(!g.hlc){var D=h._yaxis.series_u2p;if(o>=f[0]-g._tickLength&&o<=f[0]+g._tickLength){return{seriesIndex:E,pointIndex:a,gridData:f,data:h.data[a]}}}else{var D=h._yaxis.series_u2p;if(o>=f[0]-g._tickLength&&o<=f[0]+g._tickLength){return{seriesIndex:E,pointIndex:a,gridData:f,data:h.data[a]}}}}}else{y=Math.sqrt((o-f[0])*(o-f[0]));if(y<=t&&(y<=v||v==null)){v=y;return{seriesIndex:E,pointIndex:a,gridData:f,data:h.data[a]}}}}}break}}return null}function bz(B,b,g){var z=b.plugins.cursor;var l="";var s=bu(B,b);var q=b.series;var C=0;var u;for(var a=0;a<by.length;a++){if(by[a].type==a5.MainInstrument){C=by[a].index;u=by[a]}}var k=q[C].index;var r=q[C].label.toString();var y=(b.plugins.trendlineOverlay!==undefined&&b.plugins.trendlineOverlay.trendlines.length>0);var f=undefined;var j=undefined;if(s.xaxis!=null){var w=u.ohlc[parseInt(s.xaxis)];if(w!==undefined){var e=q[C]._xaxis.tickOptions.formatter;var v=$.jqplot.DefaultTickFormatter;var x=q[C]._xaxis.tickOptions.formatString;var n=(q[C]._yaxis.formatStringTooltip!==undefined)?q[C]._yaxis.formatStringTooltip:q[C]._yaxis.tickOptions.formatString;if(z.showCustomTooltip){if(z.followMouse&&z.tooltipLocation!=="outside"&&!y){l+=z.tooltipFormatString.replace("%0%",e("yyyy-mm-dd",w[0])).replace("%00%",e("HH:MM",w[0])).replace("%1%",v(n,w[4])).replace("%2%",v(n,(w[1]!==undefined)?w[1]:w[4])).replace("%3%",v(n,(w[2]!==undefined)?w[2]:w[4])).replace("%4%",v(n,(w[3]!==undefined)?w[3]:w[4])).replace("%5%",v("%.0f",w[5]))}else{l+=z.tooltipFormatStringFixed.replace("%0%",e(x,w[0])).replace("%00%",e("HH:MM",w[0])).replace("%1%",v(n,w[1])).replace("%2%",v(n,(w[2]!==undefined)?w[2]:w[4])).replace("%3%",v(n,(w[3]!==undefined)?w[3]:w[4])).replace("%4%",v(n,(w[4]!==undefined)?w[4]:w[4])).replace("%5%",v("%.0f",w[5]))}}}var h="";if(g!==undefined&&g.getChartState().noOfVisibleStudies>0){studiesPlot=g.getStudiesPlot();for(var c=0;c<studiesPlot.length;c++){if(z.followMouse&&!y){var t="";for(a=0;a<studiesPlot[c].series.length;a++){var w=studiesPlot[c].series[a].data[parseInt(s.xaxis)];if(w!==undefined){t+=w[1].toFixed(bs[c].decimals)+"</br>"}}if(t!==""){h+='<tr><td valign="top"><div class="nd-tooltip-yLabel" >'+bs[c].studyName+':</div></td><td><div class="nd-tooltip-y">';h+=t+"</div></td></tr>"}}else{var t="";for(a=0;a<studiesPlot[c].series.length;a++){var w=studiesPlot[c].series[a].data[parseInt(s.xaxis)];if(w!==undefined){t+='<span style="color:'+bs[c].seriesColors[a]+'">'+w[1].toFixed(bs[c].decimals)+(a<studiesPlot[c].series.length-1?"/":"")+"</span>"}}var o=bs[c].name+": "+bs[c].period+"="+t;if(t!==""){bT(g,"#nd-study-info"+c,o)}}}studiesPlot=null}var A="";for(var C=0;C<by.length;C++){if(by[C].type===a5.StudyOverlay){if(z.followMouse&&!y){var t="";for(a=0;a<by[C].seriesCount;a++){var w=q[by[C].index+a].data[parseInt(s.xaxis)];if(w!==undefined){t+=w[1].toFixed(by[C].decimals)+"</br>"}}if(t!==""){A+='<tr><td valign="top"><div class="nd-tooltip-yLabel" >'+by[C].studyName+':</div></td><td><div class="nd-tooltip-y">';A+=t+"</div></td></tr>"}}else{var t="";for(a=0;a<by[C].seriesCount;a++){var w=q[by[C].index+a].data[parseInt(s.xaxis)];if(w!==undefined){t+='<span style="color:'+by[C].seriesColors[a]+'">'+w[1].toFixed(by[C].decimals)+" </span>"}}if(t!==""){bT(g,"#nd-infoW-"+by[C].id,t)}}}}if(A!==""||h!==""){l=l.substring(0,l.lastIndexOf("</table>"));l+=A+h+"</table></div>";A=h=""}if(z.tooltipLocation=="outside"){var m=$("#staticTooltip"+bH.globalId);m.html(l)}else{z._tooltipElem.html(l);l=null;if(z.followMouse&&!y){aO(B,b)}else{bZ(b)}if(g!==undefined&&g.infoWindowTheme.colorTooltip!==undefined){$(".nd-tooltip").css("background-color","");$(".nd-tooltip").css("background-color",g.infoWindowTheme.colorTooltip);$(".nd-tooltip-static").css("color",g.infoWindowTheme.color)}z._tooltipElem.show()}}else{}z=q=s=null}function bu(b,e){var a={xaxis:null,yaxis:null,x2axis:null,y2axis:null,y3axis:null,y4axis:null,y5axis:null,y6axis:null,y7axis:null,y8axis:null,y9axis:null,yMidAxis:null};var g=["xaxis","yaxis","x2axis","y2axis","y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis","yMidAxis"];var f=e.axes;var c,h;for(c=11;c>0;c--){h=g[c-1];if(f[h].show){a[h]=f[h].series_p2u(b[h.charAt(0)])}}g=f=c=h=null;return a}function bN(l,f,g){var k={indices:[],data:[]};var e,n,a,j,o,c,b;var m;var h=l.plugins.cursor;for(var n=0;n<l.series.length;n++){if(by[n].type==a5.MainInstrument){e=l.series[n];c=e.renderer;if(e.show){m=h.intersectionThreshold;if(e.showMarker){m+=e.markerRenderer.size/2}for(var o=0;o<e.gridData.length;o++){b=e.gridData[o];if(Math.abs(f-b[0])<=m){k.indices.push(n);k.data.push({seriesIndex:n,pointIndex:o,gridData:b,intersectGrid:{x:f,y:g},data:by[n].ohlc[o]})}}}}}e=n=a=j=o=c=b=null;return k}function bZ(c){var f=c._gridPadding;var b=c.plugins.cursor;var e=b._tooltipElem;var g,a;switch(b.tooltipLocation){case"nw":if($(chartContainerId+" .nd-information-window").width()+e.width()>c._plotDimensions.width-c._gridPadding.right-bQ.padding){$(chartContainerId+" .nd-information-window").hide();g=f.left+b.tooltipOffset}else{g=f.left+b.tooltipOffset+$(chartContainerId+" .nd-information-window").width();$(chartContainerId+" .nd-tooltip-static").html(" - "+$(chartContainerId+" .nd-tooltip-static").html())}a=f.top+1.5;e.css("left",g);e.css("top",a);break;case"ne":g=f.right+b.tooltipOffset;a=f.top;e.css({right:g,top:a});break;case"se":g=f.right+b.tooltipOffset;a=f.bottom+b.tooltipOffset+$(".nd-copyright-notice").height();e.css({right:g,bottom:a});break;case"sw":g=f.left+b.tooltipOffset;a=f.bottom+b.tooltipOffset+$(".nd-copyright-notice").height();e.css({left:g,bottom:a});break;default:g=f.right-b.tooltipOffset;a=f.bottom+b.tooltipOffset;e.css({right:g,bottom:a});break}f=b=e=null}function aO(g,e,f,h){var b=e.plugins.cursor;f=f||b._tooltipElem;switch(h||b.tooltipLocation){case"x":var a=g.x+e._gridPadding.left;if(g.x+e._gridPadding.left+f.outerWidth()>e._plotDimensions.width-e._gridPadding.right){a=g.x+e._gridPadding.left-f.outerWidth()}var c=f.css("top");break;case"y":var a=f.css("left");var c=g.y+e._gridPadding.top+f.outerHeight()/2;default:var a=g.x+e._gridPadding.left;if(g.x+e._gridPadding.left+f.outerWidth()>e._plotDimensions.width-e._gridPadding.right){a=g.x+e._gridPadding.left-f.outerWidth()}var c=f.css("top");break}f.css("left",a);f.css("top",c);b=f=null}function bt(c,f){$("#xPointer").remove();$("#yPointer").remove();$("#y2Pointer").remove();$("#staticTooltip"+bH.globalId).empty();var b=f.chartPlot.plugins.cursor;if(b&&b._tooltipElem){b._tooltipElem.emptyForce()}var b=f.chartPlot.plugins.cursor;var a=b.cursorCanvas._ctx;a.clearRect(0,0,a.canvas.width,a.canvas.height);a=null;if(f.getChartState().isVolumeVisible){var b=f.volumePlot.plugins.cursor;var a=b.cursorCanvas._ctx;a.clearRect(0,0,a.canvas.width,a.canvas.height);a=null}if(f.getChartState().noOfVisibleStudies>0){for(var e=0;e<f.studiesPlot.length;e++){var b=f.studiesPlot[e].plugins.cursor;var a=b.cursorCanvas._ctx;a.clearRect(0,0,a.canvas.width,a.canvas.height);a=null}}}function bv(h,b,e){if(h.options.cursor.showHorizontalLine){var c=$("#y2Pointer");if(e===true||c.length===0){c.innerHTML="";c.outerHTML="";c=$('<div id="y2Pointer" class="y2Pointer" style="position:absolute;"></div>').appendTo(h.target)}var c=$("#y2Pointer");var k=h.axes.y2axis;var j=k._ticks[0];var g=j.formatter(j.formatString,b);c.html(g);var a=h._gridPadding.left+h.grid._width+3+"px";var f=k.u2p(b)-c.outerHeight()/2+"px";c.css({left:a,top:f});c.css("width",k._elem.css("width")+10);c.innerHTML="";c.outerHTML="";c=k=j=g=a=f=null}}function a8(h,b,e){if(h.options.cursor.showHorizontalLine){var c=$("#yPointer");if(e===true||c.length===0){c=$('<div id="yPointer" class="yPointer" style="position:absolute;"></div>').appendTo(h.target)}var k=h.axes.yaxis;var j=k._ticks[0];var g=j.formatter(j.formatString,b);c.html(g);var a="-7px";c.css("width",k._elem.css("width")+10);var f=k.u2p(b)-c.outerHeight()/2+"px";c.css({left:a,top:f});c=k=j=g=a=f=null}}function aX(j,b,f){if(j.options.cursor.showVerticalLine){var c=$("#xPointer");if(f===true||c.length===0){c=$('<div id="xPointer" class="xPointer" style="position:absolute;"></div>').appendTo(j.target)}var c=$("#xPointer");var k=j.axes.xaxis;var e=k.tickOptions.formatter;var h=k.tickOptions.formatString;c.html(e(h,b));var g=j._gridPadding.top+j.grid._height+3+"px";var a=k.u2p(b)-c.outerWidth()/2-5+"px";c.css({left:a,top:g});c=k=tick=str=a=g=null}}this.intersection=function(a,b){var f=a.data;var g=b.data;if(this.timeScale==0){this.timeScale=1}var e=parseInt(this.timeScale)*60;var k=[];for(var h=0;h<f.length;h++){k.push(parseInt(a.dateTimeArr[f[h][0]]/e)*e)}var l=[];for(h=0;h<g.length;h++){l.push(parseInt(b.dateTimeArr[g[h][0]]/e)*e)}var h=0;var j=0;var m=[];while(h<f.length&&j<g.length){var c=k[h];var n=l[j];if(c<n){h++}else{if(c>n){j++}else{m.push(f[h][0]);h++;j++}}}return m}};Netdania.ChartComponent.CreateMenu=function(e){Netdania.ChartComponent.CreateMenu.isMenuVisible=false;Netdania.ChartComponent.CreateMenu.ddWidth=0;Netdania.ChartComponent.CreateMenu.ddHeight=0;ddlId="nd-ddl"+e.componentId;this.ulID="";this.ddlId=ddlId;Netdania.ChartComponent.CreateMenu.buttonContDiv="nd-c-div"+e.componentId;this.createButtons=function(){var a=$("#"+this.ddlId).parent().next();$("#"+this.ddlId).button().click(function(){if(Netdania.ChartComponent.CreateMenu.isMenuVisible==false){var b=$(this).position();var g=$(this).outerWidth();a.css({position:"absolute",top:b.top+this.height+"px",left:(b.left)+"px"}).show("fast")}else{a.hide()}Netdania.ChartComponent.CreateMenu.isMenuVisible=!Netdania.ChartComponent.CreateMenu.isMenuVisible}).mouseenter(function(){if(Netdania.ChartComponent.CreateMenu.isMenuVisible==false){var b=$(this).position();var g=$(this).outerWidth();a.css({position:"absolute",top:b.top+this.height+"px",left:(b.left)+"px"}).show("fast")}else{a.hide()}Netdania.ChartComponent.CreateMenu.isMenuVisible=!Netdania.ChartComponent.CreateMenu.isMenuVisible}).mouseout(function(){}).parent().next().hide().menu();$("#"+this.ddlId).width(e.width==undefined?140:e.width);Netdania.ChartComponent.CreateMenu.ddWidth=$("#"+this.ddlId).width();Netdania.ChartComponent.CreateMenu.ddHeight=$("#"+this.ddlId).height();a.width(Netdania.ChartComponent.CreateMenu.ddWidth);a.mouseout(function(){if(Netdania.ChartComponent.CreateMenu.isMenuVisible==true){}});$("#"+Netdania.ChartComponent.CreateMenu.buttonContDiv).width(Netdania.ChartComponent.CreateMenu.ddWidth+ +2);$("#"+Netdania.ChartComponent.CreateMenu.buttonContDiv).mouseleave(function(){a.hide();Netdania.ChartComponent.CreateMenu.isMenuVisible=false})};this.createDiv=function(){$('<div id="'+Netdania.ChartComponent.CreateMenu.buttonContDiv+'" class="nd-ddl"></div>').appendTo("#"+e.id);$('<div ><button id="'+ddlId+'" style="margin-right:0px; padding:0;" class="nd-menu-ddl-defaulttext">'+e.defaultText+"</button></div>").appendTo("#"+Netdania.ChartComponent.CreateMenu.buttonContDiv)};this.subscribeToEvent=function(a){$("#"+this.ulID+" li").each(function(b){$(this).find("span").width($("#"+this.ulID).width());$(this).find("span").bind(e.event,function(h,j){a(j.param,e.id)})})};var c=e.isDD==undefined?true:false;this.createUL=function(b){this.ulID="listMenu"+ddlId;var a=$('<ul id="'+this.ulID+'" class="nd-ddl1 fg-toolbar ui-widget-header ui-corner-all ui-helper-clearfix">');$.each(b,function(j,h){$('<li id="'+j+'" onclick="Netdania.ChartComponent.CreateMenu.closeMenu($(this), \''+ddlId+"', '"+e.event+"', '"+c+"')\">").html('<a href="javascript:void(0);"><span class="nd-menuItem" style="border:0 !important; background-color:transparent !important;">'+h+"</span></a>").appendTo(a)});a.appendTo("#"+Netdania.ChartComponent.CreateMenu.buttonContDiv)};this.init=function(){this.createDiv();this.createUL(e.instruments);this.createButtons();$("#listMenu"+ddlId).width(e.ddlWidth==undefined?120:e.ddlWidth);return $("#listMenu"+ddlId)};triggerEvent=function(b,g,a){b.trigger(g,{param:a})};Netdania.ChartComponent.CreateMenu.closeMenu=function(n,m,l,k){var a=$("#"+m).parent().next();if(k=="true"){$("#"+m).text(n.text())}var b=n.attr("id");span=n.find("span");l.id=m;triggerEvent(span,l,b);Netdania.ChartComponent.CreateMenu.isMenuVisible=!Netdania.ChartComponent.CreateMenu.isMenuVisible;a.hide()}};Netdania.ChartComponent.beforeFullscreen="";Netdania.ChartComponent.beforeH=0;Netdania.ChartComponent.beforeW=0;Netdania.ChartComponent.ChartComponentInit=function(config){config.globalId=Netdania.Utilities.globalCurrentCmp++;chartContainerId="#nd-chartContainer"+config.globalId;var containerId=config.containerId||"chartComp";config.width-=10;config.height-=10;config.numberOfPoints=Netdania.Utilities.isBelowIEX()?(config.numberOfPoints>300?300:config.numberOfPoints):config.numberOfPoints;config.backImgURL="url(css/images/loading.gif)";$("#"+containerId).append('<div style="width:'+config.width+'px;" id="nd-chartContainer'+config.globalId+'" class="nd-chartContainer nd-chartContainer-relative ui-widget-content"></div><div id="nd-mask"></div>');var topToolbarId="nd-toptoolbar";var bottomToolbarId="nd-bottom";config.ttbId=topToolbarId;config.btbId=bottomToolbarId;config.plotId="nd-chartPlot";config.instrumentsOverlay=config.instrumentsOverlay||config.instruments;config.instrumentsRelativeTo=config.instrumentsRelativeTo||config.instruments;this.Chart=new Netdania.ChartRenderer(config);var chart=this.Chart;this.mainChartPlot=null;var thisObj=this;this.toolbar=null;var instruments=getMenuInstruments(config.instruments);var chartTypes={candleStick:"Candle Stick",heikinAshi:"Heikin Ashi",barOHLC:"Bar OHLC",line:"Line",barHLC:"Bar HLC"};Netdania.ChartComponent.overlayInstruments=getMenuInstruments(config.instrumentsOverlay||config.instruments);Netdania.ChartComponent.relativeToInstruments=getMenuInstruments(config.instrumentsRelativeTo||config.instruments);Netdania.ChartComponent.Studies=config.studies||{MACD:"Average, Convergence-Divergence",BOLL:"Bollinger Bands",MOM:"Momentum",SMA:"Moving Average",MAE:"Moving Average Exponential",RSI:"Relative Strength Index"};Netdania.ChartComponent.Trendlines=["Close","High","Low","FreeHand","Horizontal Close","Horizontal High","Horizontal Low","Horizontal FreeHand"];function getMenuInstruments(instrumentsGeneral){chartComponentInstruments=new Object();if(instrumentsGeneral!==undefined){for(var i=0;i<instrumentsGeneral.length;i++){var instr=instrumentsGeneral[i].toString().split("|");chartComponentInstruments[i]=instr[1]}}return chartComponentInstruments}this.initChartComponent=function(){var id=config.globalId;this.initMenu(id);if(config.showTopToolbar!==false){if(config.showInstrumentsMenu!==false){this.createInstrDDLMenu(instruments,topToolbarId+id)}if(config.showChartTypeMenu!==false){this.createChartTypeDDLMenu(chartTypes,topToolbarId+id)}if(config.showViewMenu!==false){this.createViewMenu(topToolbarId+id)}if(config.showOverlayMenu!==false){this.createOverlayDDLMenu(Netdania.ChartComponent.overlayInstruments,topToolbarId+id)}if(config.showRelativeMenu!==false){this.createRelativeToDDLMenu(Netdania.ChartComponent.relativeToInstruments,topToolbarId+id)}if(config.showStudiesMenu!==false){this.createStudiesMenu(Netdania.ChartComponent.Studies,topToolbarId+id)}var showTrendlineMenu=config.showTrendlineMenu.split("|")[0];if(eval(showTrendlineMenu)!==false){this.createTrendlineMenu(Netdania.ChartComponent.Trendlines,topToolbarId+id)}if(config.showFullButton!==false){this.createFullScreenButton(topToolbarId,id)}if(config.showVolumeButton!==false){this.createVolumeButton(id)}if(config.showZoomButton!==false){this.createZoomButton(id)}if(config.showPrintButton!==false&&!Netdania.Utilities.isBelowIEX()){this.createPrintButton(topToolbarId,id)}var currentInstrumentIndex=-1;for(var i=0,length=config.instruments.length;i<length;i++){if(typeof config.instruments[i]==="string"&&config.instruments[i].indexOf(config.name)>-1){currentInstrumentIndex=i}}}if(config.showBottomToolbar!==false){this.toolbar=this.createTimescalesToolbar(this.changeTimescale,"nd-bottom"+id,config.timescale,config.toolbarTimescales);if(config.showThemeToolbar!==false){$(function(){$('<div style="position: absolute; left:'+($("#timescalesnd-bottom"+id).width()+50)+'px" id="themes"/>').insertAfter("#timescalesnd-bottom"+id).themeswitcher({height:150,initialText:"Change Skin",loadTheme:config.defaultTheme||"UI darkness",buttonPreText:"Skin: ",buttonHeight:13,onSelect:changeTheme})})}else{$(function(){$('<div style="display:none" id="themes"/>').insertAfter("#timescalesnd-bottom"+id).themeswitcher({height:150,initialText:"Change Skin",loadTheme:config.defaultTheme||"UI darkness",buttonPreText:"Skin: ",buttonHeight:13,onSelect:changeTheme})})}}else{$(function(){$('<div style="display:none" id="themes"/>').appendTo("#nd-chartContainer"+id).themeswitcher({height:150,initialText:"Change Skin",loadTheme:config.defaultTheme||"UI darkness",buttonPreText:"Skin: ",buttonHeight:13,onSelect:changeTheme})})}this.Chart.initChart();$.jqplot.postDrawHooks.push(function(){$(".jqplot-cursor-tooltip").css("z-index","3");$(".jqplot-event-canvas").css("z-index","3")});globalComp=this};var getNumberOfVisibleMenus=function(){return(config.showInstrumentsMenu===undefined?1:config.showInstrumentsMenu)+(config.showChartTypeMenu===undefined?1:config.showChartTypeMenu)+(config.showViewMenu===undefined?1:config.showViewMenu)+(config.showOverlayMenu===undefined?1:config.showOverlayMenu)+(config.showRelativeMenu===undefined?1:config.showRelativeMenu)+(config.showStudiesMenu===undefined?1:config.showStudiesMenu)};this.initMenu=function(id){var noOfVisibleMenus=getNumberOfVisibleMenus();var chartPlotHeight=config.height;if(config.showTopToolbar!==false){$('<div id="'+topToolbarId+id+'" class="fg-toolbar ui-widget-header ui-corner-all ui-helper-clearfix"></div>').appendTo("#nd-chartContainer"+id);chartPlotHeight=(noOfVisibleMenus*140>config.width)?(config.height-($.browser.msie?60:70)):config.height-($.browser.msie?37:40)}if(config.tooltipLocation=="outside"){$('<div id="staticTooltip'+config.globalId+'" class="" style="height:15px;font-size:12px;"></div>').insertBefore("#nd-chartContainer"+id)}if(config.showBottomToolbar!==false){chartPlotHeight=chartPlotHeight-($.browser.msie?28:20);$('<div id="nd-chartPlot'+id+'" class="'+(Netdania.Utilities.isBelowIEX(7)?"":"nd-chartPlot")+'" style="height:'+chartPlotHeight+'px"></div>').appendTo("#nd-chartContainer"+id);$('<div id="nd-bottom'+id+'"  class="fg-toolbar ui-widget-header ui-corner-all ui-helper-clearfix nd-tbbottom"></div>').appendTo("#nd-chartContainer"+id)}else{$('<div id="nd-chartPlot'+id+'" class="'+(Netdania.Utilities.isBelowIEX(7)?"":"nd-chartPlot")+'" style="height:'+chartPlotHeight+'px"></div>').appendTo("#nd-chartContainer"+id)}};this.createBottomToolbar=function(id){$('<div id="nd-bottom'+id+'"  class="fg-toolbar ui-widget-header ui-corner-all ui-helper-clearfix nd-tbbottom" style="position:absolute; bottom:0px"></div>').appendTo("#nd-chartContainer"+id)};this.createInstrDDLMenu=function(instruments,id){var config={instruments:instruments,componentId:++Netdania.Utilities.globalCurrentCmp,event:"changeInstrument",defaultText:"Instruments",width:80,id:id,isDD:false};var ddMenu=new Netdania.ChartComponent.CreateMenu(config);ddMenu.init();ddMenu.subscribeToEvent(thisObj.changeInstrument)};this.createViewMenu=function(id){var config={instruments:{period:"Periods",ShowV:"Vertical Grid",ShowH:"Horizontal Grid",Zoom:"Zoom toolbar",Volume:"Volume"},componentId:++Netdania.Utilities.globalCurrentCmp,event:"viewMenuSelect",defaultText:"View",id:id,width:60,isDD:false};var ddMenu=new Netdania.ChartComponent.CreateMenu(config);ddMenu.init();ddMenu.subscribeToEvent(thisObj.viewMenuSelect)};this.createChartTypeDDLMenu=function(chartTypes,id){var config={instruments:chartTypes,componentId:++Netdania.Utilities.globalCurrentCmp,event:"changeChartType",defaultText:"Chart Type",width:80,id:id,ddlWidth:105,isDD:false};var ddMenu=new Netdania.ChartComponent.CreateMenu(config);ddMenu.init();ddMenu.subscribeToEvent(thisObj.changeChartType)};this.createOverlayDDLMenu=function(instrumentsOver,id){var config={instruments:instrumentsOver,componentId:++Netdania.Utilities.globalCurrentCmp,event:"addOverlay",defaultText:"Overlay",id:id,width:80,isDD:false};var ddMenu=new Netdania.ChartComponent.CreateMenu(config);ddMenu.init();ddMenu.subscribeToEvent(thisObj.addOverlay)};this.createRelativeToDDLMenu=function(instrumentsRT,id){var config={instruments:instrumentsRT,componentId:++Netdania.Utilities.globalCurrentCmp,event:"addRelativeTo",defaultText:"Relative To",id:id,width:90,isDD:false};var ddMenu=new Netdania.ChartComponent.CreateMenu(config);ddMenu.init();ddMenu.subscribeToEvent(thisObj.addRelativeTo)};this.createStudiesMenu=function(studies,id){var config={instruments:studies,componentId:++Netdania.Utilities.globalCurrentCmp,event:"addStudy",defaultText:"Studies",id:id,width:80,ddlWidth:185,isDD:false};var ddMenu=new Netdania.ChartComponent.CreateMenu(config);ddMenu.init();ddMenu.subscribeToEvent(thisObj.addStudy)};this.createTrendlineMenu=function(studies,id){var config={instruments:studies,componentId:++Netdania.Utilities.globalCurrentCmp,event:"addTrendline",defaultText:"Lines",id:id,width:60,ddlWidth:120,isDD:false};var ddMenu=new Netdania.ChartComponent.CreateMenu(config);ddMenu.init();ddMenu.subscribeToEvent(thisObj.addTrendline);this.Chart.trendLineComp=ddMenu};var studyDivName="nd-study-form";var studyPeriodsName="nd-study-periods";var studyForm="nd-study-form";var studyColorName="nd-study-color";var studyColorPickerName="nd-study-color-picker";var studyParametersName="nd-study-parameters";this.addStudy=function(study,id){try{$("#"+studyDivName+id).remove()}catch(ex){}try{$("#"+studyColorPickerName+id).remove()}catch(ex){}$('<div id="'+studyDivName+id+'"  title="Study settings" ><fieldset style="width:260px;border-radius:5px;"><legend style="color:#888;padding-bottom:3px;">Parameters</legend><table id="'+studyParametersName+id+'" style=""></table></fieldset></br><fieldset style="width:260px;border-radius:5px;"><legend style="color:#888;padding-bottom:3px;">Colors</legend><div id="'+studyColorName+id+'" style=""></div></fieldset></br><span class="nd-validateTips" style="margin-left: 0px; margin-top: 10px;font-size:10px;"></span></div>').appendTo("#"+id);var height=220;for(var key in Netdania.StudyTypes[study].parameters){$('<tr><td><label for="'+key+id+'" style="text-transform:capitalize;">'+key+'</label></td><td ><input type="text" style="width: 120px; margin-left:5px" name="'+key+id+'" id="'+key+id+'" class="text ui-widget-content ui-corner-all" value="'+Netdania.StudyTypes[study].parameters[key]+'" /></td></tr>').appendTo("#"+studyParametersName+id);height+=27}for(var i=0;i<Netdania.StudyTypes[study].seriesCount;i++){$('<input type="color" id="'+studyColorPickerName+id+i+'" value="'+Netdania.StudyTypes[study].seriesColors[i]+'" data-hex="true" alt="Choose color" data-text="hidden" style="height:20px;width:20px;margin-right:5px" seriesId ="'+i+'" />').appendTo("#"+studyColorName+id);$("#"+studyColorPickerName+id+i).mColorPicker();$("#"+studyColorPickerName+id+i).bind("colorpicked",function(ev){Netdania.StudyTypes[study].seriesColors[this.attributes.seriesId.value]=$(this).val()})}allFields=$([]).add(name);$("#"+studyForm+id).dialog({autoOpen:true,height:height,width:300,modal:true,zIndex:10000,dialogClass:"nd-dialog",resizable:false,buttons:{OK:function(){var parameters={};var bValid=true;for(var key in Netdania.StudyTypes[study].parameters){var name=$("#"+key+id);name.removeClass("ui-state-error");if(parseInt(Netdania.StudyTypes[study].parameters[key])==parseFloat(Netdania.StudyTypes[study].parameters[key])){bValid=bValid&&checkRegexp(name,/^([0-9])+$/i,"Please insert a valid number for "+key+"!");bValid=bValid&&checkLength(name,chart.getMaxNumberOfHistoricalPoints(),1,key);parameters[key]=parseInt(name.val())}else{decimals=Netdania.StudyTypes[study].parameters[key].toString().split(".")[1].length;bValid=bValid&&checkRegexp(name,/^-?[0-9]+(\.[0-9]+)?$/i,"Please insert a valid number for "+key+"!");bValid=bValid&&checkLength(name,1,(1/Math.pow(10,decimals)),key);parameters[key]=parseFloat(name.val())}}if(bValid){chart.addStudy(study,thisObj.toolbar,parameters);$(this).dialog("close")}},Cancel:function(){$.fn.mColorPicker.closePicker();$(this).dialog("close")}},close:function(){$.fn.mColorPicker.closePicker()}});$(window).on("keypress",".nd-dialog",function(event){if((event.which&&event.which==13)||(event.keyCode&&event.keyCode==13)){$(".ui-dialog-buttonpane button:first",$(this)).click();return false}})};this.createVolumeButton=function(id){$('<button style="float:right;margin-top:2px" class="nd-vol" id="nd-volume'+id+'" name="nd-volume">Show/Hide Volume</button>').appendTo("#"+topToolbarId+id);$("#nd-volume"+id).button({icons:{primary:"nd-volume-icon"},text:false});$("#nd-volume"+id).click(function(e){chart.addVolume()})};this.createZoomButton=function(id){$('<button style="float:right;margin-top:2px" class="nd-zoom" id="nd-zoom'+id+'" name="nd-zoom">Show/Hide Zoom Bar</button>').appendTo("#"+topToolbarId+id);$("#nd-zoom"+id).button({icons:{primary:"ui-icon-zoomin"},text:false});$("#nd-zoom"+id).click(function(e){chart.addZoom()})};this.createColorPicker=function(id){$('<input type="color" id="color_5'+id+'" value="#ff0000" data-hex="true" alt="Choose color" data-text="hidden" style="height:20px;width:20px;margin-right:5px" />').appendTo("#nd-bottom"+id);$("#color_5"+id).mColorPicker();$("#color_5"+id).bind("colorpicked",function(){changeTheme($(this).val())})};this.createPrintButton=function(tbid,id){$('<button style="float:right;margin-top:2px" class="nd-vol" id="nd-print'+id+'" name="nd-print">Print</button>').appendTo("#"+tbid+id);$("#nd-print"+id).button({icons:{primary:"ui-icon-print"},text:false});$("#nd-print"+id).click(function(e){$("#nd-chartContainer"+id).print()})};this.createFullScreenButton=function(tbid,id){$('<button style="float:right;margin-top:2px" class="nd-vol" id="nd-fs'+id+'" name="nd-fs">Set/Remove Fullscreen</button>').appendTo("#"+tbid+id);$("#nd-fs"+id).button({icons:{primary:"ui-icon-extlink"},text:false});var chartContainer=$("#nd-chartContainer"+id);var chartDivBeforeHeight;var chartDivBeforeWidth;var chartPlotBeforeHeight;$("#nd-fs"+id).click(function(e){$("body").trigger("Custom.BeginWork");var self=chart.getSelf();setTimeout(function(){try{if(!chartContainer.hasClass("fullscreen")){Netdania.ChartComponent.beforeFullscreen={parentElement:chartContainer.parent(),index:chartContainer.parent().children().index(chartContainer),x:$(window).scrollLeft(),y:$(window).scrollTop()};Netdania.ChartComponent.beforeH=chartContainer.height();Netdania.ChartComponent.beforeW=chartContainer.width();chartContainer.removeClass("nd-chartContainer-relative");chartContainer.addClass("fullscreen");var chartDiv=$("#nd-chartDiv"+id);chartDivBeforeHeight=chartDiv.height();chartDivBeforeWidth=chartDiv.width();chartPlotBeforeHeight=$("#nd-chartPlot"+config.globalId).height();$("#nd-chartPlot"+config.globalId).height($(window).height()-$("#"+config.btbId+config.globalId).height()*2.5);chartDiv.height(chart.getChartState().computeMainChartHeight()*0.01*$("#"+config.plotId+config.globalId).height());chartDiv.width($("body").width()-15-config.padding);$("body").append(chartContainer);chartContainer.height($(window).height()-12);chartContainer.width($("body").width()-12);addCompleteTopMenubar(globalComp,id);var mainChartPlot=chart.getPlot();$.jqplot.Trendline.removeTrendlineMode(mainChartPlot);chart.replotPublic(mainChartPlot,{resetAxes:true},self);var widthY2Axis=$(".jqplot-axis.jqplot-y2axis").width();var widthYAxis=$(".jqplot-axis.jqplot-yaxis").width();var mainPlotWidth=$("#nd-chartDiv"+id).width();var volume=chart.getVolumePlot();if(volume){var height=chart.getChartState().getVolumeChartHeight()+"%";if(chart.overlay){$("#volumeChart"+id).attr("style",$("#volumeChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthY2Axis-widthYAxis)+"px !important;height:"+height)}else{if(config.vaxis=="left"){$("#volumeChart"+id).attr("style",$("#volumeChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthYAxis)+"px !important;height:"+height)}else{$("#volumeChart"+id).attr("style",$("#volumeChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthY2Axis)+"px !important;height:"+height)}}chart.replotPublic(volume,{resetAxes:false},self);var top=-volume.grid._plotDimensions.height+"px";$("#nd-close-volumeChart"+id).css("margin-top",top)}var zoomBar=chart.getZoomPlot();if(zoomBar){var height=chart.getChartState().getZoomChartHeight()+"%";if(chart.overlay){$("#nd-zoomChart"+id).attr("style",$("#nd-zoomChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthY2Axis-widthYAxis)+"px !important;height:"+height)}else{if(config.vaxis=="left"){$("#nd-zoomChart"+id).attr("style",$("#nd-zoomChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthYAxis)+"px !important;height:"+height)}else{$("#nd-zoomChart"+id).attr("style",$("#nd-zoomChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthY2Axis)+"px !important;height:"+height)}}chart.replotPublic(zoomBar,{resetAxes:true},self);var top=-zoomBar.grid._plotDimensions.height+"px";$("#nd-close-nd-zoomChart"+id).css("margin-top",top);$.jqplot.Cursor.zoomProxy(chart.chartPlot,chart.zoomPlot,true)}if(chart.studiesPlot.length>0){var height=chart.getChartState().getStudyChartHeight()+"%";var studies=self.getStudies();for(var stIndex=0;stIndex<chart.studiesPlot.length;stIndex++){var studyId=chart.studiesPlot[stIndex].targetId.replace("#nd-study-","");$(chart.studiesPlot[stIndex].targetId).attr("style",$(chart.studiesPlot[stIndex].targetId).attr("style")+"%; width: "+mainPlotWidth+"px !important;height:"+height);chart.replotPublic(chart.studiesPlot[stIndex],{resetAxes:true},self,"nd-study-info"+studyId,studies[stIndex].studyName+": "+studies[stIndex].period+"="+chart.studiesPlot[stIndex].data[chart.studiesPlot[stIndex].data.length-1][1]);var closeId="nd-close-nd-study-"+studyId;var top=-chart.studiesPlot[stIndex].grid._plotDimensions.height+"px";$("#"+closeId).css("margin-top",top)}}$(".nd-close-button").css("left",mainPlotWidth);var points=chart.getConfig().zoomNumberOfPoints;if(zoomBar){chart.zoomDefaultPublic(chart.zoomPlot,points,chart)}else{chart.zoomDefaultPublic(chart.chartPlot,points,chart)}window.scroll(0,0);chartDiv=zoomBar=mainChartPlot=volume=null}else{chartContainer.removeClass("fullscreen");chartContainer.addClass("nd-chartContainer-relative");removeFullScreenTopMenubar(globalComp,id);if(Netdania.ChartComponent.beforeFullscreen.index>=Netdania.ChartComponent.beforeFullscreen.parentElement.children().length){Netdania.ChartComponent.beforeFullscreen.parentElement.append(chartContainer)}else{chartContainer.insertBefore(Netdania.ChartComponent.beforeFullscreen.parentElement.children().get(Netdania.ChartComponent.beforeFullscreen.index))}$("body").css("overflow","visible");$("html").css("overflow","visible");chartContainer.height(Netdania.ChartComponent.beforeH);chartContainer.width(Netdania.ChartComponent.beforeW);$("#nd-chartPlot"+config.globalId).height(chartPlotBeforeHeight);var chartDiv=$("#nd-chartDiv"+id);chartDiv.width(chartDivBeforeWidth);chartDiv.height(chart.getChartState().computeMainChartHeight()+"%");var mainChartPlot=chart.getPlot();$.jqplot.Trendline.removeTrendlineMode(mainChartPlot);chart.replotPublic(mainChartPlot,{resetAxes:true},self);widthYAxis=$(".jqplot-axis.jqplot-yaxis").width();widthY2Axis=$(".jqplot-axis.jqplot-y2axis").width();mainPlotWidth=$("#nd-chartDiv"+id).width();var volume=chart.getVolumePlot();if(volume){var height=chart.getChartState().getVolumeChartHeight()+"%";if(self.overlay){$("#volumeChart"+id).attr("style",$("#volumeChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthYAxis-widthY2Axis)+"px !important;height:"+height)}else{if(config.vaxis=="left"){$("#volumeChart"+id).attr("style",$("#volumeChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthYAxis)+"px !important;height:"+height)}else{$("#volumeChart"+id).attr("style",$("#volumeChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthY2Axis)+"px !important;height:"+height)}}chart.replotPublic(volume,{resetAxes:false},self);var top=-volume.grid._plotDimensions.height+"px";$("#nd-close-volumeChart"+id).css("margin-top",top)}var zoomBar=chart.getZoomPlot();if(zoomBar){var height=chart.getChartState().getZoomChartHeight()+"%";if(self.overlay){$("#nd-zoomChart"+id).attr("style",$("#nd-zoomChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthYAxis-widthY2Axis)+"px !important;height:"+height)}else{if(config.vaxis=="left"){$("#nd-zoomChart"+id).attr("style",$("#nd-zoomChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthYAxis)+"px !important;height:"+height)}else{$("#nd-zoomChart"+id).attr("style",$("#nd-zoomChart"+id).attr("style")+"%; width: "+(mainPlotWidth-widthY2Axis)+"px !important;height:"+height)}}chart.replotPublic(zoomBar,{resetAxes:true},self);var top=-zoomBar.grid._plotDimensions.height+"px";$("#nd-close-nd-zoomChart"+id).css("margin-top",top);$.jqplot.Cursor.zoomProxy(chart.chartPlot,chart.zoomPlot,true)}if(chart.studiesPlot.length>0){var height=chart.getChartState().getStudyChartHeight()+"%";var studies=self.getStudies();for(var stIndex=0;stIndex<chart.studiesPlot.length;stIndex++){var studyId=chart.studiesPlot[stIndex].targetId.replace("#nd-study-","");$(chart.studiesPlot[stIndex].targetId).attr("style",$(chart.studiesPlot[stIndex].targetId).attr("style")+"%; width: "+mainPlotWidth+"px !important;height:"+height);chart.replotPublic(chart.studiesPlot[stIndex],{resetAxes:true},self,"nd-study-info"+studyId,studies[stIndex].studyName+": "+studies[stIndex].period+"="+chart.studiesPlot[stIndex].data[chart.studiesPlot[stIndex].data.length-1][1]);var closeId="nd-close-nd-study-"+studyId;var top=-chart.studiesPlot[stIndex].grid._plotDimensions.height+"px";$("#"+closeId).css("margin-top",top)}studies=null}$(".nd-close-button").css("left",mainPlotWidth);var points=chart.getConfig().zoomNumberOfPoints;if(zoomBar){chart.zoomDefaultPublic(chart.zoomPlot,points,chart)}else{chart.zoomDefaultPublic(chart.chartPlot,points,chart)}window.scroll(Netdania.ChartComponent.beforeFullscreen.x,Netdania.ChartComponent.beforeFullscreen.y);$.jqplot.Trendline.removeTrendlineMode(mainChartPlot);chartDiv=zoomBar=mainChartPlot=volume=null}if(chart.trendLineComp&&(chart.chartType===chart.ChartTypesEnum.DOT||chart.chartType===chart.ChartTypesEnum.FOREST||chart.chartType===chart.ChartTypesEnum.LINE||chart.chartType===chart.ChartTypesEnum.LINEDOT||chart.chartType===chart.ChartTypesEnum.AREA)){chart.disableMenuOptions(chart.trendLineComp,[1,2,5,6])}else{if(chart.trendLineComp){chart.rebindEvents(chart.trendLineComp,[1,2,5,6])}}return false}finally{$("body").trigger("Custom.EndWork")}},50)})};var addCompleteTopMenubar=function(componentId,id){var currentInstrumentIndex=-1;for(var i=0,length=config.instruments.length;i<length;i++){if(typeof config.instruments[i]==="string"&&config.instruments[i].indexOf(config.symbol)>-1){currentInstrumentIndex=i}}if(config.showInstrumentsMenu==false){componentId.createInstrDDLMenu(instruments,topToolbarId+id)}if(config.showChartTypeMenu==false){componentId.createChartTypeDDLMenu(chartTypes,topToolbarId+id)}if(config.showViewMenu==false){componentId.createViewMenu(topToolbarId+id)}if(config.showOverlayMenu==false){componentId.createOverlayDDLMenu(Netdania.ChartComponent.overlayInstruments,topToolbarId+id);$("#nd-c-div"+Netdania.Utilities.globalCurrentCmp+" ul").find("#"+currentInstrumentIndex).hide()}if(config.showRelativeMenu==false){componentId.createRelativeToDDLMenu(Netdania.ChartComponent.relativeToInstruments,topToolbarId+id);$("#nd-c-div"+Netdania.Utilities.globalCurrentCmp+" ul").find("#"+currentInstrumentIndex).hide()}if(config.showStudiesMenu==false){componentId.createStudiesMenu(Netdania.ChartComponent.Studies,topToolbarId+id)}var showTrendlineMenu=config.showTrendlineMenu.split("|")[1];if(eval(showTrendlineMenu)===true){componentId.createTrendlineMenu(Netdania.ChartComponent.Trendlines,topToolbarId+id)}if(config.showVolumeButton==false){componentId.createVolumeButton(id)}if(config.showZoomButton==false){componentId.createZoomButton(id)}if(config.showPrintButton==false&&!Netdania.Utilities.isBelowIEX()){componentId.createPrintButton(topToolbarId,id)}};removeFullScreenTopMenubar=function(componentId,id){if(config.hideIndicators){chart.removeAllInstrumentExceptMainInstrument(chart.getSelf())}$("#"+topToolbarId+id).empty();if(config.showInstrumentsMenu!==false){componentId.createInstrDDLMenu(instruments,topToolbarId+id)}if(config.showChartTypeMenu!==false){componentId.createChartTypeDDLMenu(chartTypes,topToolbarId+id)}if(config.showViewMenu!==false){componentId.createViewMenu(topToolbarId+id)}if(config.showOverlayMenu!==false){componentId.createOverlayDDLMenu(Netdania.ChartComponent.overlayInstruments,topToolbarId+id)}if(config.showRelativeMenu!==false){componentId.createRelativeToDDLMenu(Netdania.ChartComponent.relativeToInstruments,topToolbarId+id)}if(config.showStudiesMenu!==false){componentId.createStudiesMenu(Netdania.ChartComponent.Studies,topToolbarId+id)}var showTrendlineMenu=config.showTrendlineMenu.split("|")[0];if(eval(showTrendlineMenu)!==false){componentId.createTrendlineMenu(Netdania.ChartComponent.Trendlines,topToolbarId+id)}if(config.showFullButton!==false){componentId.createFullScreenButton(topToolbarId,id)}if(config.showVolumeButton!==false){componentId.createVolumeButton(id)}if(config.showZoomButton!==false){componentId.createZoomButton(id)}if(config.showPrintButton!==false&&!Netdania.Utilities.isBelowIEX()){componentId.createPrintButton(topToolbarId,id)}};resize=function(width,height){};var changeTheme=function(color){if(!chart.getPlot()){return}chart.changeTheme(chart.getPlot(),"chart",true,true);var studiesPlots=chart.getStudiesPlot();$(studiesPlots).each(function(index,value){chart.changeTheme(value,"study",true)});if(chart.getChartState().isVolumeVisible){chart.changeTheme(chart.getVolumePlot(),"volume",true)}chart.getSelf().addInformationWindowPublic(chart.getPlot(),chart.getSelf());chart.getSelf().addCopyrightNoticePublic(chart.getPlot(),chart.getSelf());if(chart.getChartState().isZoomBarVisible){chart.changeTheme(chart.getZoomPlot(),"zoom",true,true)}};this.changeInstrument=function(symbol,external){chart.changeInstrument(symbol,external)};this.changeTimescale=function(timescale,points){chart.changeTimescale(timescale,points)};this.changeChartType=function(chartType){chart.changeChartType(chartType,thisObj.toolbar)};this.addOverlay=function(symbol){chart.addOverlay(symbol,thisObj.toolbar)};this.removeOverlay=function(){chart.removeOverlay()};this.addTrendline=function(type){chart.addTrendline(type)};this.addRelativeTo=function(symbol){chart.addRelativeTo(symbol,thisObj.toolbar)};this.viewMenuSelect=function(menu,id){switch(menu){case"period":changePeriod(menu,id);break;case"ShowV":case"ShowH":showGridLines(menu,id);break;case"Zoom":chart.addZoom();break;case"Volume":chart.addVolume();break;default:break}};function updateTips(t){tips=$(".nd-validateTips");tips.text(t).addClass("ui-state-highlight");setTimeout(function(){tips.removeClass("ui-state-highlight",1500)},500)}function checkLength(o,max,min,fieldName){var min=min===undefined?20:min;if(o.val()>max){o.addClass("ui-state-error");if(fieldName!==undefined){updateTips("Maximum "+fieldName+" value: "+max)}else{updateTips("Maximum periods: "+max)}return false}else{if(o.val()<min){o.addClass("ui-state-error");if(fieldName!==undefined){updateTips("Minimum "+fieldName+" value: "+max)}else{updateTips("Number of periods >= "+min+".")}return false}else{return true}}}function checkRegexp(o,regexp,n){if(!(regexp.test(o.val()))){o.addClass("ui-state-error");updateTips(n);return false}else{return true}}var changePeriod=function(menu,id){try{$("#nd-period-form"+id).remove()}catch(ex){}$('<div id="nd-period-form'+id+'"  title="Periods" style="padding-top:10px;">Periods<input type="text" style="width: 110px; margin-left:5px" name="nd-periods'+id+'" id="nd-periods'+id+'" class="text ui-widget-content ui-corner-all" /><div class="nd-validateTips" style="margin-top: 10px;float:left"></div></div>').appendTo("#"+id);allFields=$([]).add(name);var name=$("#nd-periods"+id);try{$("#nd-periods"+id).val(chart.getConfig().zoomNumberOfPoints)}catch(ex){}$("#nd-period-form"+id).dialog({autoOpen:true,height:140,width:200,modal:true,zIndex:10000,dialogClass:"nd-dialog",resizable:false,buttons:{OK:function(){var bValid=true;bValid=bValid&&checkLength(name,chart.getMaxNumberOfHistoricalPoints());bValid=bValid&&checkRegexp(name,/^([0-9])+$/i,"Please insert a number!");if(bValid){chart.changePeriod(parseInt(name.val()));$(this).dialog("close")}},Cancel:function(){$(this).dialog("close")}},close:function(){}});$(window).on("keypress",".nd-dialog",function(event){if((event.which&&event.which==13)||(event.keyCode&&event.keyCode==13)){$(".ui-dialog-buttonpane button:first",$(this)).click();return false}})};var showGridLines=function(type,id){chart.showGridLines(type)};this.getMainChartPlot=function(){this.mainChartPlot=chart.getPlot()};$("#getPlot").click(function(){mainChartPlot=chart.getPlot();replot(mainChartPlot,{resetAxes:true},chart.getSelf())});this.selectTimescale=function(timescale,points){var i=-1;var firstIndex=0;$("#timescales"+this.idToolbar).find('input[name="nd-radio'+this.idToolbar+'"]').each(function(index,ts){if(ts.value===timescale.toString()&&ts.attributes.points.nodeValue==points){i=index;return false}});if(i==-1){var firstindex=-1;$("#timescales"+this.idToolbar).find('input[name="nd-radio'+this.idToolbar+'"]').each(function(index,ts){if(ts.value===timescale.toString()){firstindex=index;return false}})}timescale=i!==-1?i:firstindex;try{$("#timescales"+this.idToolbar).find('input[name="nd-radio'+this.idToolbar+'"]')[timescale].checked=true;$("#timescales"+this.idToolbar).buttonset("refresh")}catch(ex){}};this.createTimescalesToolbar=function(changeTimeScale,id,timescaleDefault,configTimescales){this.idToolbar=id;var defaultTimescales=["T|0|"+config.numberOfPoints,"1|1|"+config.numberOfPoints,"5|5|"+config.numberOfPoints,"10|10|"+config.numberOfPoints,"15|15|"+config.numberOfPoints,"30|30|"+config.numberOfPoints,"1H|60|"+config.numberOfPoints,"2H|120|"+config.numberOfPoints,"8H|480|"+config.numberOfPoints,"D|1440|"+config.numberOfPoints,"W|10080|"+config.numberOfPoints,"M|43200|"+config.numberOfPoints];configTimescales=(configTimescales!==undefined&&configTimescales.length>0)?configTimescales:defaultTimescales;var timescalesDiv='<div id="timescales'+id+'" class="nd-ddl nd-ts">';$(configTimescales).each(function(index,value){var labelvaluePair=value.split("|");timescalesDiv+='<input type="radio" id="radio'+index+""+id+'" name="nd-radio'+id+'" value="'+labelvaluePair[1]+'" points="'+labelvaluePair[2]+'"/><label class="nd-ts-label" for="radio'+index+""+id+'" value="'+labelvaluePair[1]+'">'+labelvaluePair[0]+"</label>"});timescalesDiv+="</div>";$(timescalesDiv).appendTo("#"+id);$("#timescales"+id).buttonset();$("#timescales"+id+" :radio").click(function(e){var rawElement=this;var $element=$(this);changeTimeScale($element.val(),$element.attr("points"))});this.selectTimescale(timescaleDefault,config.numberOfPoints);return this}};Netdania.scriptsLoaded=true;var globalComp;Netdania.RenderChart=function(e){var c;c=new Netdania.ChartComponent.ChartComponentInit(e);c.initChartComponent();globalComp=c;return c};Netdania.RenderChartNew=function(b){chartComponentP=new Netdania.ChartComponent.ChartComponentInit(b);chartComponentP.initChartComponent();globalComp=chartComponentP};function changeInstrument(c,e){}function update(e,f,g){globalComp.Chart.id=g;globalComp.Chart.update($.parseJSON(e),f,g)}function addStudy(b){globalComp.Chart.addStudy(b)};